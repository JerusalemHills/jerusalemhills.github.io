class AccessibilityEnhancer{constructor(e={}){this.options={announcePageChanges:!0,announceGameEvents:!0,announceScore:!0,skipLinksEnabled:!0,landmarkNavigation:!0,keyboardShortcuts:!0,highContrastMode:!1,focusIndicators:!0,reducedMotion:!1,...e},this.announcer=null,this.focusHistory=[],this.shortcuts=new Map,this.init()}init(){this.createAnnouncer(),this.addSkipLinks(),this.enhanceKeyboardNavigation(),this.addARIALabels(),this.setupGameAccessibility(),this.addKeyboardShortcuts(),this.handleUserPreferences(),console.log("Accessibility enhancements initialized")}createAnnouncer(){this.announcer=document.createElement("div"),this.announcer.setAttribute("aria-live","polite"),this.announcer.setAttribute("aria-atomic","true"),this.announcer.className="sr-only announcer",this.announcer.id="accessibility-announcer",this.urgentAnnouncer=document.createElement("div"),this.urgentAnnouncer.setAttribute("aria-live","assertive"),this.urgentAnnouncer.setAttribute("aria-atomic","true"),this.urgentAnnouncer.className="sr-only announcer",this.urgentAnnouncer.id="urgent-announcer",document.body.appendChild(this.announcer),document.body.appendChild(this.urgentAnnouncer)}announce(e,t=!1){if(!this.options.announceGameEvents&&!t)return;const n=t?this.urgentAnnouncer:this.announcer;n.textContent=e,setTimeout(()=>{n.textContent=""},1e3)}addSkipLinks(){if(!this.options.skipLinksEnabled)return;const e=document.createElement("div");e.className="skip-links",e.innerHTML='\n            <a href="#main-content" class="skip-link">Skip to main content</a>\n            <a href="#navigation" class="skip-link">Skip to navigation</a>\n            <a href="#game-area" class="skip-link">Skip to game</a>\n        ',document.body.insertBefore(e,document.body.firstChild)}enhanceKeyboardNavigation(){document.addEventListener("keydown",e=>{"Tab"===e.key&&this.handleTabKey(e),"Escape"===e.key&&this.handleEscapeKey(e),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key)&&this.handleArrowKeys(e)}),document.addEventListener("focusin",e=>{this.focusHistory.push(e.target),this.focusHistory.length>10&&this.focusHistory.shift()})}handleTabKey(e){const t=document.querySelector(".modal.active, .dialog[open]");t&&this.trapFocus(e,t)}handleEscapeKey(e){const t=document.querySelector(".modal.active, .dialog[open]");if(t){const e=t.querySelector(".close, [data-close]");return void(e&&e.click())}const n=document.querySelectorAll(".selected, .highlighted");n.length>0&&(n.forEach(e=>{e.classList.remove("selected","highlighted")}),this.announce("Selection cleared"))}handleArrowKeys(e){const t=e.target,n=t.closest(".grid, .game-board, .sudoku-grid, .memory-grid");n&&(e.preventDefault(),this.navigateGrid(t,e.key,n))}navigateGrid(e,t,n){const o=Array.from(n.querySelectorAll(".cell, .grid-cell, .checker, .card, button")),i=o.indexOf(e);if(-1===i)return;const a=this.getGridColumns(n);let r;switch(t){case"ArrowUp":r=i-a;break;case"ArrowDown":r=i+a;break;case"ArrowLeft":r=i-1;break;case"ArrowRight":r=i+1}r>=0&&r<o.length&&o[r]&&(o[r].focus(),this.announceGridPosition(o[r],r,a))}getGridColumns(e){const t=window.getComputedStyle(e).gridTemplateColumns;if(t&&"none"!==t)return t.split(" ").length;const n=e.querySelectorAll(".cell, .grid-cell");return Math.sqrt(n.length)||4}announceGridPosition(e,t,n){const o=Math.floor(t/n)+1,i=t%n+1,a=e.textContent?.trim()||e.getAttribute("aria-label")||"empty";this.announce(`Row ${o}, Column ${i}, ${a}`)}trapFocus(e,t){const n=t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),o=n[0],i=n[n.length-1];e.shiftKey&&document.activeElement===o?(e.preventDefault(),i.focus()):e.shiftKey||document.activeElement!==i||(e.preventDefault(),o.focus())}addARIALabels(){this.enhanceButtons(),this.enhanceInputs(),this.enhanceNavigationStructure(),this.enhanceGameElements()}enhanceButtons(){document.querySelectorAll("button:not([aria-label]):not([aria-labelledby])").forEach(e=>{const t=e.textContent?.trim(),n=e.querySelector("i, svg, .icon");if(!t&&n){const t=n.className||"";t.includes("close")?e.setAttribute("aria-label","Close"):t.includes("menu")?e.setAttribute("aria-label","Open menu"):t.includes("play")?e.setAttribute("aria-label","Play"):t.includes("pause")?e.setAttribute("aria-label","Pause"):t.includes("stop")?e.setAttribute("aria-label","Stop"):e.setAttribute("aria-label","Button")}})}enhanceInputs(){document.querySelectorAll("input:not([aria-label]):not([aria-labelledby])").forEach(e=>{const t=document.querySelector(`label[for="${e.id}"]`),n=e.getAttribute("placeholder");!t&&n?e.setAttribute("aria-label",n):t||n||e.setAttribute("aria-label","search"===e.type?"Search":"Input field")})}enhanceNavigationStructure(){const e=document.querySelector("nav:not([aria-label]):not([aria-labelledby])");e&&e.setAttribute("aria-label","Main navigation");const t=document.querySelector("main:not([aria-label]):not([aria-labelledby])");t&&t.setAttribute("aria-label","Main content"),this.fixHeadingHierarchy()}fixHeadingHierarchy(){const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6");let t=0;e.forEach(e=>{const n=parseInt(e.tagName.charAt(1));n>t+1&&console.warn(`Heading hierarchy jump detected: ${e.tagName} follows h${t}`),t=n})}enhanceGameElements(){this.enhanceGameBoard(),this.enhanceScoreDisplays(),this.enhanceGameControls()}enhanceGameBoard(){document.querySelectorAll(".game-board, .grid-container, .sudoku-grid").forEach(e=>{e.getAttribute("role")||(e.setAttribute("role","grid"),e.setAttribute("aria-label","Game board"));e.querySelectorAll(".cell, .grid-cell").forEach((t,n)=>{t.getAttribute("role")||(t.setAttribute("role","gridcell"),t.setAttribute("tabindex","0"));const o=this.getGridColumns(e),i=Math.floor(n/o)+1,a=n%o+1;if(!t.getAttribute("aria-label")){const e=t.textContent?.trim()||"empty";t.setAttribute("aria-label",`Row ${i}, Column ${a}, ${e}`)}})})}enhanceScoreDisplays(){document.querySelectorAll(".score, .points, .timer").forEach(e=>{e.getAttribute("aria-live")||(e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"))})}enhanceGameControls(){const e=document.querySelector('[onclick*="rollDice"], .roll-btn');e&&!e.getAttribute("aria-label")&&e.setAttribute("aria-label","Roll dice");const t=document.querySelector('[onclick*="newGame"], .new-game-btn');t&&!t.getAttribute("aria-label")&&t.setAttribute("aria-label","Start new game");const n=document.querySelector('[onclick*="undo"], .undo-btn');n&&!n.getAttribute("aria-label")&&n.setAttribute("aria-label","Undo last move")}setupGameAccessibility(){this.setup2048Accessibility(),this.setupBackgammonAccessibility(),this.setupSudokuAccessibility(),this.setupMemoryGameAccessibility()}setup2048Accessibility(){if(!document.querySelector(".grid-container, .tile-container"))return;this.announce("2048 game loaded. Use arrow keys to move tiles.");const e=document.getElementById("score");if(e){new MutationObserver(()=>{this.options.announceScore&&this.announce(`Score: ${e.textContent}`)}).observe(e,{childList:!0,subtree:!0})}}setupBackgammonAccessibility(){document.querySelector(".checker, .point")&&(this.announce("Backgammon game loaded. Use tab to navigate pieces and points."),document.querySelectorAll(".checker").forEach((e,t)=>{const n=e.classList.contains("white")?"white":"black",o=e.closest(".point"),i=o?o.dataset.point||"bar":"unknown";e.setAttribute("aria-label",`${n} checker on point ${i}`),e.setAttribute("tabindex","0")}))}setupSudokuAccessibility(){document.querySelector(".sudoku-grid")&&(this.announce("Sudoku puzzle loaded. Use arrow keys to navigate cells, number keys to enter values."),document.querySelectorAll(".sudoku-cell").forEach(e=>{e.addEventListener("focus",()=>{const t=e.textContent?.trim()||"empty",n=e.getAttribute("aria-label")||"";this.announce(`${n}, ${t}`)})}))}setupMemoryGameAccessibility(){document.querySelector(".memory-grid, .memory-card")&&(this.announce("Memory matching game loaded. Use tab or arrow keys to navigate cards."),document.querySelectorAll(".memory-card, .card").forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-content")||e.textContent?.trim();this.announce(`Card revealed: ${t}`)})}))}addKeyboardShortcuts(){this.options.keyboardShortcuts&&(this.shortcuts.set("h",()=>this.showKeyboardHelp()),this.shortcuts.set("?",()=>this.showKeyboardHelp()),this.shortcuts.set("/",()=>this.focusSearch()),this.shortcuts.set("g+h",()=>this.goToHome()),this.shortcuts.set("g+g",()=>this.goToGames()),this.shortcuts.set("g+m",()=>this.goToMarketplace()),document.addEventListener("keydown",e=>{if(e.target.matches("input, textarea, select"))return;const t=e.key.toLowerCase(),n=e.ctrlKey?`ctrl+${t}`:e.altKey?`alt+${t}`:t;this.shortcuts.has(n)&&(e.preventDefault(),this.shortcuts.get(n)())}))}showKeyboardHelp(){const e="\nKeyboard Shortcuts:\n- H or ?: Show this help\n- /: Focus search\n- Tab: Navigate interactive elements\n- Arrow keys: Navigate game grids\n- Escape: Close dialogs or clear selections\n- G+H: Go to home page\n- G+G: Go to games\n- G+M: Go to marketplace\n\nGame Controls:\n- Arrow keys: Move in 2048\n- Tab/Arrow keys: Navigate pieces in Backgammon\n- Number keys: Enter values in Sudoku\n- Space/Enter: Select cards in Memory games\n        ";this.announce(e,!0),console.log(e)}focusSearch(){const e=document.querySelector('#product-search, .search-input, input[type="search"]');e&&(e.focus(),this.announce("Search focused"))}goToHome(){window.location.href="/"}goToGames(){window.location.href="/games/"}goToMarketplace(){window.location.href="/marketplace.html"}handleUserPreferences(){window.matchMedia("(prefers-reduced-motion: reduce)").matches&&(this.options.reducedMotion=!0,document.documentElement.style.setProperty("--animation-duration","0s")),window.matchMedia("(prefers-contrast: high)").matches&&(this.options.highContrastMode=!0,document.body.classList.add("high-contrast")),window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",e=>{this.options.reducedMotion=e.matches,document.documentElement.style.setProperty("--animation-duration",e.matches?"0s":"")})}announceGameEvent(e,t=""){this.options.announceGameEvents&&this.announce(`${e}${t?": "+t:""}`)}announceScore(e,t="Score"){this.options.announceScore&&this.announce(`${t}: ${e}`)}focusElement(e){const t=document.querySelector(e);return!!t&&(t.focus(),!0)}}const accessibilityCSS='\n/* Screen reader only content */\n.sr-only, .visually-hidden {\n    position: absolute;\n    width: 1px;\n    height: 1px;\n    padding: 0;\n    margin: -1px;\n    overflow: hidden;\n    clip: rect(0, 0, 0, 0);\n    white-space: nowrap;\n    border: 0;\n}\n\n/* Skip links */\n.skip-links {\n    position: fixed;\n    top: 0;\n    left: 0;\n    z-index: 9999;\n}\n\n.skip-link {\n    position: absolute;\n    top: -40px;\n    left: 6px;\n    background: #000;\n    color: #fff;\n    padding: 8px;\n    text-decoration: none;\n    border-radius: 0 0 6px 6px;\n    transition: top 0.3s;\n}\n\n.skip-link:focus {\n    top: 0;\n}\n\n/* Enhanced focus indicators */\n:focus {\n    outline: 2px solid #91D9F8;\n    outline-offset: 2px;\n    border-radius: 2px;\n}\n\nbutton:focus, .btn:focus {\n    box-shadow: 0 0 0 3px rgba(145, 217, 248, 0.5);\n}\n\n/* High contrast mode */\n.high-contrast {\n    filter: contrast(150%);\n}\n\n.high-contrast button,\n.high-contrast .btn {\n    border: 2px solid currentColor;\n}\n\n/* Reduced motion */\n@media (prefers-reduced-motion: reduce) {\n    *, *::before, *::after {\n        animation-duration: 0.01ms !important;\n        animation-iteration-count: 1 !important;\n        transition-duration: 0.01ms !important;\n        scroll-behavior: auto !important;\n    }\n}\n\n/* Grid navigation indicators */\n.grid-cell:focus::after,\n.cell:focus::after {\n    content: \'\';\n    position: absolute;\n    top: -2px;\n    left: -2px;\n    right: -2px;\n    bottom: -2px;\n    border: 3px solid #91D9F8;\n    border-radius: 4px;\n    pointer-events: none;\n}\n\n/* Modal focus trapping */\n.modal.active,\n.dialog[open] {\n    isolation: isolate;\n}\n\n/* Touch target enhancement for accessibility */\n@media (pointer: coarse) {\n    button, .btn, a, input[type="button"], input[type="submit"] {\n        min-height: 44px;\n        min-width: 44px;\n    }\n}\n',style=document.createElement("style");style.textContent=accessibilityCSS,document.head.appendChild(style),window.addEventListener("DOMContentLoaded",()=>{window.accessibilityEnhancer=new AccessibilityEnhancer,window.announceGameEvent=(e,t)=>{window.accessibilityEnhancer.announceGameEvent(e,t)},window.announceScore=(e,t)=>{window.accessibilityEnhancer.announceScore(e,t)}});