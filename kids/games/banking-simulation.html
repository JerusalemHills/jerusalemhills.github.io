<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Banking & Credit Simulation - Jerusalem Hills Kids</title>
    
    <link rel="stylesheet" href="../assets/css/kids.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Badge System -->
    <script src="../assets/js/badge-system.js"></script>
    
    <style>
        .banking-game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            min-height: 100vh;
            color: white;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .bank-panel, .customer-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            color: #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .bank-panel {
            border-left: 5px solid #3498db;
        }

        .customer-panel {
            border-left: 5px solid #e74c3c;
        }

        .panel-header {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2C3E50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .status-card.highlight {
            border-color: #667eea;
            background: #e8f4f8;
        }

        .status-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2C3E50;
        }

        .status-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .scenario-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            color: #333;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .scenario-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .scenario-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .scenario-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .scenario-btn.active {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
        }

        .scenario-description {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 5px solid #3498db;
        }

        .action-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            color: #333;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .loan-calculator {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .input-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2C3E50;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .calculation-result {
            background: linear-gradient(135deg, #e8f5e8, #d4f4d4);
            border: 2px solid #4CAF50;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: #2C3E50;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .learning-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            color: #333;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .concept-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #667eea;
        }

        .concept-title {
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 10px;
        }

        .quiz-section {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            border: 2px solid #FF9800;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .quiz-question {
            font-weight: 600;
            margin-bottom: 15px;
            color: #2C3E50;
        }

        .quiz-options {
            display: grid;
            gap: 10px;
        }

        .quiz-option {
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            border-color: #FF9800;
            background: #fff8f0;
        }

        .quiz-option.correct {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .quiz-option.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .back-button {
            background: linear-gradient(135deg, #95E1D3, #F093FB);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .risk-bar {
            flex-grow: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
        }

        .risk-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .risk-low .risk-fill { background: #4CAF50; }
        .risk-medium .risk-fill { background: #FF9800; }
        .risk-high .risk-fill { background: #f44336; }

        @media (max-width: 768px) {
            .simulation-area {
                grid-template-columns: 1fr;
            }

            .loan-calculator {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }

            .scenario-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="banking-game-container">
        <a href="../index.html" class="back-button">
            ‚ÜêÔ∏è Back to Games
        </a>

        <div class="game-header">
            <h1>üè¶ Banking & Credit Simulation</h1>
            <p>Learn how banks work, understand loans, and master financial responsibility!</p>
        </div>

        <!-- Scenario Selector -->
        <div class="scenario-selector">
            <h2>üíº Choose Your Financial Adventure</h2>
            <div class="scenario-buttons">
                <button class="scenario-btn active" onclick="bankingGame.selectScenario('basics')">
                    <h3>üè¶ Bank Basics</h3>
                    <p>Learn how banks work and make money</p>
                </button>
                <button class="scenario-btn" onclick="bankingGame.selectScenario('loan')">
                    <h3>üí∞ Getting a Loan</h3>
                    <p>Understand loans, interest, and collateral</p>
                </button>
                <button class="scenario-btn" onclick="bankingGame.selectScenario('mortgage')">
                    <h3>üè† Home Mortgage</h3>
                    <p>Buy your first house with a mortgage</p>
                </button>
                <button class="scenario-btn" onclick="bankingGame.selectScenario('credit')">
                    <h3>üí≥ Credit Cards</h3>
                    <p>Learn about credit and responsible spending</p>
                </button>
            </div>
            <div class="scenario-description" id="scenario-description">
                Click a scenario above to start learning about banking and credit!
            </div>
        </div>

        <!-- Simulation Area -->
        <div class="simulation-area" id="simulation-area" style="display: none;">
            <div class="bank-panel">
                <div class="panel-header">
                    üè¶ First National Bank
                </div>
                <div class="status-grid" id="bank-status">
                    <!-- Bank status will be populated by JavaScript -->
                </div>
            </div>

            <div class="customer-panel">
                <div class="panel-header">
                    üë§ Your Financial Status
                </div>
                <div class="status-grid" id="customer-status">
                    <!-- Customer status will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Action Panel -->
        <div class="action-panel" id="action-panel" style="display: none;">
            <!-- Action content will be populated by JavaScript -->
        </div>

        <!-- Learning Section -->
        <div class="learning-section" id="learning-section">
            <h2>üìö Banking Concepts to Learn</h2>
            
            <div class="concept-card">
                <div class="concept-title">üí∞ Interest Rates</div>
                <p>The percentage of money charged for borrowing or earned for saving. If you borrow $100 at 5% interest, you'll pay back $105.</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">üè† Collateral</div>
                <p>Something valuable you promise to give the bank if you can't pay back a loan. For a house loan, the house itself is collateral!</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">üìä Credit Score</div>
                <p>A number (300-850) that shows how good you are at paying back money. Higher scores get better loan deals!</p>
            </div>

            <div class="concept-card">
                <div class="concept-title">‚öñÔ∏è Leverage</div>
                <p>Using borrowed money to buy something bigger than you could afford with just your own money. It can multiply gains... and losses!</p>
            </div>
        </div>
    </div>

    <script>
        class BankingSimulation {
            constructor() {
                this.currentScenario = 'basics';
                this.bankData = {
                    reserves: 100000,
                    loansOutstanding: 500000,
                    deposits: 800000,
                    interestRate: 5.0
                };
                this.customerData = {
                    savings: 10000,
                    income: 50000,
                    creditScore: 650,
                    debt: 0,
                    assets: 10000
                };
                this.init();
            }

            init() {
                this.updateDisplays();
            }

            selectScenario(scenario) {
                this.currentScenario = scenario;
                
                // Update button states
                document.querySelectorAll('.scenario-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.closest('.scenario-btn').classList.add('active');

                this.showScenarioContent();
            }

            showScenarioContent() {
                const scenarios = {
                    'basics': {
                        description: 'üè¶ Learn how banks work! Banks take deposits from savers and lend money to borrowers. They make money from the difference between what they pay savers and charge borrowers.',
                        content: this.createBasicsContent()
                    },
                    'loan': {
                        description: 'üí∞ Getting a loan means borrowing money you promise to pay back with interest. Banks check your ability to repay before approving loans.',
                        content: this.createLoanContent()
                    },
                    'mortgage': {
                        description: 'üè† A mortgage is a special loan to buy a house. The house itself guarantees the loan - if you can\'t pay, the bank can take the house.',
                        content: this.createMortgageContent()
                    },
                    'credit': {
                        description: 'üí≥ Credit cards let you borrow money for purchases. You must pay it back, often with interest if you don\'t pay the full amount quickly.',
                        content: this.createCreditContent()
                    }
                };

                document.getElementById('scenario-description').innerHTML = scenarios[this.currentScenario].description;
                document.getElementById('simulation-area').style.display = 'grid';
                document.getElementById('action-panel').style.display = 'block';
                document.getElementById('action-panel').innerHTML = scenarios[this.currentScenario].content;

                this.updateDisplays();
            }

            createBasicsContent() {
                return `
                    <h3>üè¶ How Banks Work</h3>
                    <div class="loan-calculator">
                        <div class="input-group">
                            <label>Customer Deposits ($)</label>
                            <input type="number" id="deposits" value="${this.bankData.deposits}" onchange="bankingGame.updateBankData()">
                        </div>
                        <div class="input-group">
                            <label>Interest Paid to Savers (%)</label>
                            <input type="number" id="savings-rate" value="2" step="0.1" onchange="bankingGame.updateBankData()">
                        </div>
                        <div class="input-group">
                            <label>Interest Charged to Borrowers (%)</label>
                            <input type="number" id="loan-rate" value="5" step="0.1" onchange="bankingGame.updateBankData()">
                        </div>
                    </div>
                    <div class="calculation-result" id="bank-profit">
                        <div>Bank Annual Profit</div>
                        <div class="result-value" id="profit-amount">$24,000</div>
                        <div style="font-size: 0.9rem; margin-top: 10px;">From the difference between loan and savings rates!</div>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="bankingGame.simulateBankRun()">üí® Simulate Bank Run</button>
                        <button class="action-btn" onclick="bankingGame.explainFractionalReserve()">üìä Explain Reserves</button>
                    </div>
                    <div class="quiz-section">
                        <div class="quiz-question">How do banks make money?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">They print their own money</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, true)">They charge higher interest on loans than they pay on deposits</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">They steal money from customers</div>
                        </div>
                    </div>
                `;
            }

            createLoanContent() {
                return `
                    <h3>üí∞ Loan Calculator</h3>
                    <div class="loan-calculator">
                        <div class="input-group">
                            <label>Loan Amount ($)</label>
                            <input type="number" id="loan-amount" value="10000" onchange="bankingGame.calculateLoan()">
                        </div>
                        <div class="input-group">
                            <label>Interest Rate (%)</label>
                            <input type="number" id="interest-rate" value="5" step="0.1" onchange="bankingGame.calculateLoan()">
                        </div>
                        <div class="input-group">
                            <label>Loan Term (years)</label>
                            <input type="number" id="loan-term" value="3" onchange="bankingGame.calculateLoan()">
                        </div>
                        <div class="input-group">
                            <label>Your Credit Score</label>
                            <select id="credit-score" onchange="bankingGame.calculateLoan()">
                                <option value="300">300 (Poor)</option>
                                <option value="500">500 (Fair)</option>
                                <option value="650" selected>650 (Good)</option>
                                <option value="750">750 (Excellent)</option>
                            </select>
                        </div>
                    </div>
                    <div class="calculation-result">
                        <div>Monthly Payment</div>
                        <div class="result-value" id="monthly-payment">$299</div>
                        <div style="font-size: 0.9rem; margin-top: 10px;">Total interest paid: <span id="total-interest">$774</span></div>
                    </div>
                    <div class="risk-indicator" id="loan-risk">
                        <span>Loan Risk:</span>
                        <div class="risk-bar risk-medium">
                            <div class="risk-fill" style="width: 60%"></div>
                        </div>
                        <span>Medium</span>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="bankingGame.applyForLoan()">üìã Apply for Loan</button>
                        <button class="action-btn" onclick="bankingGame.improveCredit()">üìà Improve Credit Score</button>
                    </div>
                    <div class="quiz-section">
                        <div class="quiz-question">What happens if you have a higher credit score?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">You pay higher interest rates</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, true)">You get lower interest rates and better loan terms</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">Banks won't lend to you</div>
                        </div>
                    </div>
                `;
            }

            createMortgageContent() {
                return `
                    <h3>üè† Home Mortgage Calculator</h3>
                    <div class="loan-calculator">
                        <div class="input-group">
                            <label>Home Price ($)</label>
                            <input type="number" id="home-price" value="200000" onchange="bankingGame.calculateMortgage()">
                        </div>
                        <div class="input-group">
                            <label>Down Payment ($)</label>
                            <input type="number" id="down-payment" value="40000" onchange="bankingGame.calculateMortgage()">
                        </div>
                        <div class="input-group">
                            <label>Mortgage Rate (%)</label>
                            <input type="number" id="mortgage-rate" value="4" step="0.1" onchange="bankingGame.calculateMortgage()">
                        </div>
                        <div class="input-group">
                            <label>Loan Term (years)</label>
                            <select id="mortgage-term" onchange="bankingGame.calculateMortgage()">
                                <option value="15">15 years</option>
                                <option value="30" selected>30 years</option>
                            </select>
                        </div>
                    </div>
                    <div class="calculation-result">
                        <div>Monthly Mortgage Payment</div>
                        <div class="result-value" id="mortgage-payment">$764</div>
                        <div style="font-size: 0.9rem; margin-top: 10px;">
                            Loan amount: <span id="loan-amount-display">$160,000</span><br>
                            Total interest over life of loan: <span id="mortgage-interest">$115,098</span>
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">üîë Key Mortgage Concepts</div>
                        <p><strong>Down Payment:</strong> Money you pay upfront (usually 10-20% of home price)</p>
                        <p><strong>Principal:</strong> The loan amount you borrowed</p>
                        <p><strong>Equity:</strong> How much of the house you actually own</p>
                        <p><strong>PMI:</strong> Extra insurance if you put down less than 20%</p>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="bankingGame.calculateAffordability()">üìä Check Affordability</button>
                        <button class="action-btn" onclick="bankingGame.explainForeclosure()">‚ö†Ô∏è Learn About Foreclosure</button>
                    </div>
                `;
            }

            createCreditContent() {
                return `
                    <h3>üí≥ Credit Card Simulation</h3>
                    <div class="loan-calculator">
                        <div class="input-group">
                            <label>Credit Card Balance ($)</label>
                            <input type="number" id="credit-balance" value="1000" onchange="bankingGame.calculateCredit()">
                        </div>
                        <div class="input-group">
                            <label>Credit Card APR (%)</label>
                            <input type="number" id="credit-apr" value="18" step="0.1" onchange="bankingGame.calculateCredit()">
                        </div>
                        <div class="input-group">
                            <label>Monthly Payment ($)</label>
                            <input type="number" id="credit-payment" value="50" onchange="bankingGame.calculateCredit()">
                        </div>
                        <div class="input-group">
                            <label>Credit Limit ($)</label>
                            <input type="number" id="credit-limit" value="2000" onchange="bankingGame.calculateCredit()">
                        </div>
                    </div>
                    <div class="calculation-result">
                        <div>Time to Pay Off Debt</div>
                        <div class="result-value" id="payoff-time">22 months</div>
                        <div style="font-size: 0.9rem; margin-top: 10px;">
                            Total interest paid: <span id="credit-interest">$190</span><br>
                            Credit utilization: <span id="credit-utilization">50%</span>
                        </div>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">üìä Credit Card Wisdom</div>
                        <p><strong>Pay in Full:</strong> Always try to pay your full balance to avoid interest</p>
                        <p><strong>Utilization:</strong> Keep below 30% of your credit limit for a good credit score</p>
                        <p><strong>Minimum Payments:</strong> Only paying minimums means you'll pay for years!</p>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn" onclick="bankingGame.simulateCompounding()">üìà See Debt Growth</button>
                        <button class="action-btn" onclick="bankingGame.showPayoffStrategy()">üí° Payoff Strategy</button>
                    </div>
                    <div class="quiz-section">
                        <div class="quiz-question">What's the best way to use a credit card?</div>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">Max it out and pay minimums</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, true)">Use it responsibly and pay the full balance each month</div>
                            <div class="quiz-option" onclick="bankingGame.answerQuiz(this, false)">Never use it at all</div>
                        </div>
                    </div>
                `;
            }

            updateDisplays() {
                this.updateBankStatus();
                this.updateCustomerStatus();
            }

            updateBankStatus() {
                const statusHTML = `
                    <div class="status-card">
                        <div class="status-value">$${this.bankData.reserves.toLocaleString()}</div>
                        <div class="status-label">Reserves</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">$${this.bankData.deposits.toLocaleString()}</div>
                        <div class="status-label">Customer Deposits</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">$${this.bankData.loansOutstanding.toLocaleString()}</div>
                        <div class="status-label">Loans Outstanding</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">${this.bankData.interestRate}%</div>
                        <div class="status-label">Base Rate</div>
                    </div>
                `;
                const bankStatus = document.getElementById('bank-status');
                if (bankStatus) bankStatus.innerHTML = statusHTML;
            }

            updateCustomerStatus() {
                const statusHTML = `
                    <div class="status-card">
                        <div class="status-value">$${this.customerData.savings.toLocaleString()}</div>
                        <div class="status-label">Savings</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">$${this.customerData.income.toLocaleString()}</div>
                        <div class="status-label">Annual Income</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">${this.customerData.creditScore}</div>
                        <div class="status-label">Credit Score</div>
                    </div>
                    <div class="status-card">
                        <div class="status-value">$${this.customerData.debt.toLocaleString()}</div>
                        <div class="status-label">Total Debt</div>
                    </div>
                `;
                const customerStatus = document.getElementById('customer-status');
                if (customerStatus) customerStatus.innerHTML = statusHTML;
            }

            calculateLoan() {
                const amount = parseFloat(document.getElementById('loan-amount').value) || 10000;
                const rate = parseFloat(document.getElementById('interest-rate').value) || 5;
                const term = parseFloat(document.getElementById('loan-term').value) || 3;
                const creditScore = parseFloat(document.getElementById('credit-score').value) || 650;

                // Adjust rate based on credit score
                let adjustedRate = rate;
                if (creditScore < 500) adjustedRate += 3;
                else if (creditScore < 650) adjustedRate += 1;
                else if (creditScore > 750) adjustedRate -= 0.5;

                const monthlyRate = adjustedRate / 100 / 12;
                const numPayments = term * 12;
                const monthlyPayment = amount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                const totalPaid = monthlyPayment * numPayments;
                const totalInterest = totalPaid - amount;

                document.getElementById('monthly-payment').textContent = `$${monthlyPayment.toFixed(0)}`;
                document.getElementById('total-interest').textContent = `$${totalInterest.toFixed(0)}`;

                // Update risk indicator
                const riskElement = document.getElementById('loan-risk');
                let riskLevel = 'low', riskWidth = 30;
                if (creditScore < 500 || monthlyPayment > this.customerData.income / 12 * 0.3) {
                    riskLevel = 'high';
                    riskWidth = 80;
                } else if (creditScore < 650) {
                    riskLevel = 'medium';
                    riskWidth = 60;
                }
                riskElement.className = `risk-indicator risk-${riskLevel}`;
                riskElement.querySelector('.risk-fill').style.width = riskWidth + '%';
                riskElement.querySelector('span:last-child').textContent = riskLevel.charAt(0).toUpperCase() + riskLevel.slice(1);
            }

            calculateMortgage() {
                const homePrice = parseFloat(document.getElementById('home-price').value) || 200000;
                const downPayment = parseFloat(document.getElementById('down-payment').value) || 40000;
                const rate = parseFloat(document.getElementById('mortgage-rate').value) || 4;
                const term = parseFloat(document.getElementById('mortgage-term').value) || 30;

                const loanAmount = homePrice - downPayment;
                const monthlyRate = rate / 100 / 12;
                const numPayments = term * 12;
                const monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numPayments)) / (Math.pow(1 + monthlyRate, numPayments) - 1);
                const totalPaid = monthlyPayment * numPayments;
                const totalInterest = totalPaid - loanAmount;

                document.getElementById('mortgage-payment').textContent = `$${monthlyPayment.toFixed(0)}`;
                document.getElementById('loan-amount-display').textContent = `$${loanAmount.toLocaleString()}`;
                document.getElementById('mortgage-interest').textContent = `$${totalInterest.toLocaleString()}`;
            }

            calculateCredit() {
                const balance = parseFloat(document.getElementById('credit-balance').value) || 1000;
                const apr = parseFloat(document.getElementById('credit-apr').value) || 18;
                const payment = parseFloat(document.getElementById('credit-payment').value) || 50;
                const limit = parseFloat(document.getElementById('credit-limit').value) || 2000;

                const monthlyRate = apr / 100 / 12;
                
                // Calculate payoff time
                let months = 0;
                let remainingBalance = balance;
                let totalInterest = 0;

                while (remainingBalance > 0 && months < 240) { // Cap at 20 years
                    const interestCharge = remainingBalance * monthlyRate;
                    const principalPayment = Math.min(payment - interestCharge, remainingBalance);
                    
                    if (principalPayment <= 0) break; // Payment too small
                    
                    totalInterest += interestCharge;
                    remainingBalance -= principalPayment;
                    months++;
                }

                const utilization = (balance / limit * 100).toFixed(0);

                document.getElementById('payoff-time').textContent = `${months} months`;
                document.getElementById('credit-interest').textContent = `$${totalInterest.toFixed(0)}`;
                document.getElementById('credit-utilization').textContent = `${utilization}%`;
            }

            answerQuiz(element, isCorrect) {
                // Disable all options
                element.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                    opt.style.pointerEvents = 'none';
                });

                if (isCorrect) {
                    element.classList.add('correct');
                    this.showSuccessMessage('üéâ Correct! Great understanding of banking!');
                    
                    // Track achievement
                    if (window.BadgeSystem) {
                        BadgeSystem.trackProgress('financial', 'problem_solved', 1);
                    }
                } else {
                    element.classList.add('incorrect');
                    // Show correct answer
                    element.parentElement.querySelectorAll('.quiz-option').forEach(opt => {
                        if (opt.onclick.toString().includes('true')) {
                            opt.classList.add('correct');
                        }
                    });
                }
            }

            showSuccessMessage(message) {
                const success = document.createElement('div');
                success.innerHTML = message;
                success.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #4CAF50, #45a049);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 25px;
                    font-weight: 600;
                    z-index: 1000;
                    animation: slideIn 0.5s ease;
                `;
                document.body.appendChild(success);
                setTimeout(() => success.remove(), 3000);
            }

            // Additional interactive methods
            simulateBankRun() {
                alert('üèÉ‚Äç‚ôÇÔ∏è Bank Run Simulation: If everyone tries to withdraw money at once, banks can fail because they only keep a fraction of deposits as reserves! This is why we have FDIC insurance today.');
            }

            explainFractionalReserve() {
                alert('üìä Fractional Reserve Banking: Banks only keep about 10% of deposits as reserves and lend out the rest. This creates more money in the economy but requires careful management!');
            }

            applyForLoan() {
                const creditScore = parseFloat(document.getElementById('credit-score').value) || 650;
                if (creditScore > 650) {
                    alert('‚úÖ Loan Approved! Your good credit score qualified you for our best rates.');
                } else if (creditScore > 500) {
                    alert('‚ö†Ô∏è Loan Approved with conditions. Higher interest rate due to credit score.');
                } else {
                    alert('‚ùå Loan Denied. Please work on improving your credit score first.');
                }
            }

            improveCredit() {
                this.customerData.creditScore = Math.min(850, this.customerData.creditScore + 25);
                this.updateDisplays();
                this.showSuccessMessage('üìà Credit score improved! Pay bills on time and keep balances low.');
            }
        }

        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', function() {
            window.bankingGame = new BankingSimulation();
        });
    </script>
</body>
</html>