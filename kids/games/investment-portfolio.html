<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Portfolio Game - Jerusalem Hills Kids</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Learn about investing, stocks, bonds, and portfolio management with this educational financial simulation game for kids ages 9-12.">
    <meta name="keywords" content="investment game, financial education, portfolio management, stocks, bonds, kids investing, money education">
    <meta name="robots" content="index, follow">
    
    <!-- Favicon -->
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
    
    <link rel="stylesheet" href="../assets/css/game.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Sound Manager -->
    <script src="../assets/js/sound-manager.js"></script>
    
    <style>
        .portfolio-game {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .game-header {
            text-align: center;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .game-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .investment-market {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .investment-type {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid #e0e0e0;
        }
        
        .investment-type h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .investment-options {
            display: grid;
            gap: 10px;
        }
        
        .investment-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .investment-option:hover {
            background: #e3f2fd;
            border-color: #2196F3;
        }
        
        .investment-option.selected {
            background: #e8f5e8;
            border-color: #4CAF50;
        }
        
        .option-info {
            flex: 1;
        }
        
        .option-name {
            font-weight: bold;
            color: #333;
        }
        
        .option-details {
            font-size: 0.85rem;
            color: #666;
            margin-top: 3px;
        }
        
        .option-return {
            font-weight: bold;
            color: #4CAF50;
        }
        
        .option-risk {
            font-size: 0.8rem;
            padding: 3px 8px;
            border-radius: 12px;
            margin-left: 10px;
        }
        
        .risk-low { background: #e8f5e8; color: #2e7d32; }
        .risk-medium { background: #fff3e0; color: #f57c00; }
        .risk-high { background: #ffebee; color: #c62828; }
        
        .portfolio-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .portfolio-pie {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px auto;
            position: relative;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
        }
        
        .action-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .market-events {
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .investment-amount {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
        }
        
        .amount-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .quick-amounts {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .quick-amount {
            background: #f0f0f0;
            border: 1px solid #ddd;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        
        .quick-amount:hover {
            background: #e0e0e0;
        }
        
        .timeline {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .timeline-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .time-btn {
            background: #f8f9fa;
            border: 2px solid #ddd;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .time-btn.active {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        
        .educational-tips {
            background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%);
            color: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .tip-content {
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .portfolio-game {
                padding: 10px;
            }
            
            .game-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .investment-market {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üìà Investment Portfolio Builder</h1>
        <div class="game-nav">
            <a href="../index.html" class="nav-btn">Home</a>
            <a href="trade-history.html" class="nav-btn">Trade History</a>
            <a href="banking-simulation.html" class="nav-btn">Banking</a>
        </div>
    </header>

    <div class="screen-time-reminder">
        <p>üïê Remember: Take breaks every 20 minutes and ask a grown-up for permission!</p>
    </div>

    <main class="portfolio-game">
        <div class="game-header">
            <h2>üéØ Build Your Investment Portfolio</h2>
            <p>Learn about investing by building a balanced portfolio of stocks, bonds, and savings!</p>
        </div>

        <div class="game-stats">
            <div class="stat-card">
                <div class="stat-value" id="totalMoney">$1000</div>
                <div class="stat-label">Available Cash</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="portfolioValue">$0</div>
                <div class="stat-label">Portfolio Value</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalReturn">+$0</div>
                <div class="stat-label">Total Return</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="riskLevel">Low</div>
                <div class="stat-label">Risk Level</div>
            </div>
        </div>

        <div class="market-events" id="marketEvent" style="display: none;">
            <h3>üì∞ Market News</h3>
            <p id="eventDescription"></p>
        </div>

        <div class="investment-market">
            <div class="investment-type">
                <h3>üí∞ Safe Investments</h3>
                <div class="investment-options">
                    <div class="investment-option" data-type="savings" data-return="2" data-risk="low">
                        <div class="option-info">
                            <div class="option-name">Savings Account</div>
                            <div class="option-details">Very safe, guaranteed growth</div>
                        </div>
                        <div>
                            <span class="option-return">+2%</span>
                            <span class="option-risk risk-low">Low Risk</span>
                        </div>
                    </div>
                    <div class="investment-option" data-type="bonds" data-return="4" data-risk="low">
                        <div class="option-info">
                            <div class="option-name">Government Bonds</div>
                            <div class="option-details">Stable returns, backed by government</div>
                        </div>
                        <div>
                            <span class="option-return">+4%</span>
                            <span class="option-risk risk-low">Low Risk</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="investment-type">
                <h3>üìä Moderate Investments</h3>
                <div class="investment-options">
                    <div class="investment-option" data-type="index-funds" data-return="7" data-risk="medium">
                        <div class="option-info">
                            <div class="option-name">Index Funds</div>
                            <div class="option-details">Diversified mix of many companies</div>
                        </div>
                        <div>
                            <span class="option-return">+7%</span>
                            <span class="option-risk risk-medium">Medium Risk</span>
                        </div>
                    </div>
                    <div class="investment-option" data-type="reits" data-return="6" data-risk="medium">
                        <div class="option-info">
                            <div class="option-name">Real Estate (REITs)</div>
                            <div class="option-details">Investing in buildings and property</div>
                        </div>
                        <div>
                            <span class="option-return">+6%</span>
                            <span class="option-risk risk-medium">Medium Risk</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="investment-type">
                <h3>üöÄ Growth Investments</h3>
                <div class="investment-options">
                    <div class="investment-option" data-type="large-cap-stocks" data-return="10" data-risk="medium">
                        <div class="option-info">
                            <div class="option-name">Large Company Stocks</div>
                            <div class="option-details">Shares in big, established companies</div>
                        </div>
                        <div>
                            <span class="option-return">+10%</span>
                            <span class="option-risk risk-medium">Medium Risk</span>
                        </div>
                    </div>
                    <div class="investment-option" data-type="small-cap-stocks" data-return="15" data-risk="high">
                        <div class="option-info">
                            <div class="option-name">Small Company Stocks</div>
                            <div class="option-details">Shares in smaller, growing companies</div>
                        </div>
                        <div>
                            <span class="option-return">+15%</span>
                            <span class="option-risk risk-high">High Risk</span>
                        </div>
                    </div>
                    <div class="investment-option" data-type="crypto" data-return="25" data-risk="high">
                        <div class="option-info">
                            <div class="option-name">Cryptocurrency</div>
                            <div class="option-details">Digital currency (very volatile!)</div>
                        </div>
                        <div>
                            <span class="option-return">+25%</span>
                            <span class="option-risk risk-high">High Risk</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="portfolio-section">
            <h3>üìä Your Portfolio</h3>
            <div style="display: flex; gap: 30px; align-items: center; flex-wrap: wrap;">
                <div class="portfolio-pie" id="portfolioPie">
                    <canvas width="200" height="200"></canvas>
                </div>
                <div style="flex: 1; min-width: 250px;">
                    <div id="portfolioBreakdown"></div>
                    <div class="investment-amount">
                        <label>Investment Amount: $</label>
                        <input type="number" class="amount-input" id="investmentAmount" value="100" min="1" max="1000">
                    </div>
                    <div class="quick-amounts">
                        <span class="quick-amount" onclick="setAmount(50)">$50</span>
                        <span class="quick-amount" onclick="setAmount(100)">$100</span>
                        <span class="quick-amount" onclick="setAmount(250)">$250</span>
                        <span class="quick-amount" onclick="setAmount(500)">$500</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="action-btn" onclick="investInSelected()">üìà Invest in Selected</button>
            <button class="action-btn" onclick="sellInvestment()">üìâ Sell Investment</button>
            <button class="action-btn" onclick="rebalancePortfolio()">‚öñÔ∏è Rebalance Portfolio</button>
            <button class="action-btn" onclick="nextMonth()">‚è∞ Next Month</button>
        </div>

        <div class="timeline">
            <h3>üìÖ Time Control</h3>
            <div class="timeline-controls">
                <div class="time-btn active" onclick="setTimeframe('1month')">1 Month</div>
                <div class="time-btn" onclick="setTimeframe('6months')">6 Months</div>
                <div class="time-btn" onclick="setTimeframe('1year')">1 Year</div>
                <div class="time-btn" onclick="setTimeframe('5years')">5 Years</div>
            </div>
            <div id="timeframResults"></div>
        </div>

        <div class="educational-tips">
            <h3>üí° Investment Tips</h3>
            <div class="tip-content" id="educationalTip">
                Click on different investments to learn about diversification and risk management!
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Jerusalem Hills Kids - Safe & Educational</p>
        <p><a href="../index.html">Back to Kids Zone</a></p>
    </footer>

    <script>
        class InvestmentPortfolioGame {
            constructor() {
                this.cash = 1000;
                this.portfolio = {};
                this.currentMonth = 1;
                this.selectedInvestment = null;
                this.timeframe = '1month';
                this.totalInvested = 0;
                
                this.investmentData = {
                    'savings': { name: 'Savings Account', return: 2, risk: 'low', color: '#4CAF50' },
                    'bonds': { name: 'Government Bonds', return: 4, risk: 'low', color: '#8BC34A' },
                    'index-funds': { name: 'Index Funds', return: 7, risk: 'medium', color: '#2196F3' },
                    'reits': { name: 'Real Estate', return: 6, risk: 'medium', color: '#FF9800' },
                    'large-cap-stocks': { name: 'Large Company Stocks', return: 10, risk: 'medium', color: '#9C27B0' },
                    'small-cap-stocks': { name: 'Small Company Stocks', return: 15, risk: 'high', color: '#F44336' },
                    'crypto': { name: 'Cryptocurrency', return: 25, risk: 'high', color: '#FF5722' }
                };
                
                this.marketEvents = [
                    { text: "Tech companies are growing fast! Tech stocks +20%", effect: { 'large-cap-stocks': 20, 'small-cap-stocks': 30 } },
                    { text: "Interest rates increased. Bonds doing better! Bonds +10%", effect: { 'bonds': 10, 'savings': 5 } },
                    { text: "Market correction happening. Stocks -15%", effect: { 'large-cap-stocks': -15, 'small-cap-stocks': -25, 'crypto': -30 } },
                    { text: "Real estate market booming! REITs +15%", effect: { 'reits': 15 } },
                    { text: "Cryptocurrency regulations announced. Crypto -20%", effect: { 'crypto': -20 } },
                    { text: "Economic growth strong! All investments +5%", effect: { 'all': 5 } }
                ];
                
                this.educationalTips = [
                    "Diversification means spreading your money across different types of investments to reduce risk.",
                    "High-risk investments can give bigger returns, but you can also lose more money.",
                    "It's smart to have a mix of safe and riskier investments in your portfolio.",
                    "Time is your friend in investing - the longer you invest, the more your money can grow!",
                    "Don't put all your eggs in one basket - spread your investments around.",
                    "Index funds are a great way to own tiny pieces of hundreds of companies at once.",
                    "Bonds are like lending money to the government or companies, and they pay you interest.",
                    "Stocks represent owning a small piece of a company - if the company does well, so do you!",
                    "Risk and reward usually go together - safer investments grow slower.",
                    "Rebalancing means adjusting your portfolio to keep your desired mix of investments."
                ];
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.updateDisplay();
                this.showRandomTip();
                window.soundManager.play('chime');
            }
            
            setupEventListeners() {
                // Investment option selection
                document.querySelectorAll('.investment-option').forEach(option => {
                    option.addEventListener('click', () => {
                        document.querySelectorAll('.investment-option').forEach(opt => opt.classList.remove('selected'));
                        option.classList.add('selected');
                        this.selectedInvestment = option.dataset.type;
                        window.soundManager.play('click');
                        this.showInvestmentTip(this.selectedInvestment);
                    });
                });
            }
            
            investInSelected() {
                if (!this.selectedInvestment) {
                    alert('Please select an investment first!');
                    return;
                }
                
                const amount = parseInt(document.getElementById('investmentAmount').value);
                if (amount > this.cash) {
                    alert(`You only have $${this.cash} available!`);
                    return;
                }
                
                if (!this.portfolio[this.selectedInvestment]) {
                    this.portfolio[this.selectedInvestment] = 0;
                }
                
                this.portfolio[this.selectedInvestment] += amount;
                this.cash -= amount;
                this.totalInvested += amount;
                
                window.soundManager.play('coin');
                this.updateDisplay();
                this.showRandomTip();
            }
            
            sellInvestment() {
                if (!this.selectedInvestment || !this.portfolio[this.selectedInvestment]) {
                    alert('Please select an investment you own!');
                    return;
                }
                
                const amount = Math.min(
                    parseInt(document.getElementById('investmentAmount').value),
                    this.portfolio[this.selectedInvestment]
                );
                
                this.portfolio[this.selectedInvestment] -= amount;
                this.cash += amount;
                
                if (this.portfolio[this.selectedInvestment] === 0) {
                    delete this.portfolio[this.selectedInvestment];
                }
                
                window.soundManager.play('swoosh');
                this.updateDisplay();
            }
            
            rebalancePortfolio() {
                const totalValue = this.getPortfolioValue();
                if (totalValue === 0) {
                    alert('You need investments to rebalance!');
                    return;
                }
                
                // Simple rebalancing - equal allocation
                const numInvestments = Object.keys(this.portfolio).length;
                const targetAmount = totalValue / numInvestments;
                
                Object.keys(this.portfolio).forEach(investment => {
                    this.portfolio[investment] = targetAmount;
                });
                
                window.soundManager.play('success');
                this.updateDisplay();
                this.showTip("Portfolio rebalanced! Each investment now has an equal allocation.");
            }
            
            nextMonth() {
                this.currentMonth++;
                this.simulateMarketChanges();
                this.updateDisplay();
                window.soundManager.play('chime');
                
                // Random market event
                if (Math.random() < 0.3) {
                    this.triggerMarketEvent();
                }
            }
            
            simulateMarketChanges() {
                Object.keys(this.portfolio).forEach(investment => {
                    const baseReturn = this.investmentData[investment].return;
                    const volatility = this.investmentData[investment].risk === 'high' ? 0.4 : 
                                     this.investmentData[investment].risk === 'medium' ? 0.2 : 0.1;
                    
                    const monthlyReturn = baseReturn / 12; // Annual to monthly
                    const randomFactor = (Math.random() - 0.5) * volatility;
                    const totalReturn = (monthlyReturn + randomFactor) / 100;
                    
                    this.portfolio[investment] *= (1 + totalReturn);
                });
            }
            
            triggerMarketEvent() {
                const event = this.marketEvents[Math.floor(Math.random() * this.marketEvents.length)];
                
                document.getElementById('eventDescription').textContent = event.text;
                document.getElementById('marketEvent').style.display = 'block';
                
                Object.keys(event.effect).forEach(investment => {
                    if (investment === 'all') {
                        Object.keys(this.portfolio).forEach(inv => {
                            this.portfolio[inv] *= (1 + event.effect.all / 100);
                        });
                    } else if (this.portfolio[investment]) {
                        this.portfolio[investment] *= (1 + event.effect[investment] / 100);
                    }
                });
                
                setTimeout(() => {
                    document.getElementById('marketEvent').style.display = 'none';
                }, 4000);
            }
            
            setTimeframe(timeframe) {
                this.timeframe = timeframe;
                document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');
                this.updateTimeframeResults();
            }
            
            updateTimeframeResults() {
                const months = this.timeframe === '1month' ? 1 : 
                            this.timeframe === '6months' ? 6 :
                            this.timeframe === '1year' ? 12 : 60;
                
                let projectedValue = 0;
                Object.keys(this.portfolio).forEach(investment => {
                    const currentValue = this.portfolio[investment];
                    const annualReturn = this.investmentData[investment].return / 100;
                    const futureValue = currentValue * Math.pow(1 + annualReturn, months / 12);
                    projectedValue += futureValue;
                });
                
                const currentValue = this.getPortfolioValue();
                const projectedGain = projectedValue - currentValue;
                
                document.getElementById('timeframResults').innerHTML = `
                    <div style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <div style="font-size: 1.2rem; margin-bottom: 10px;">
                            Projected portfolio value in ${this.timeframe}: 
                            <strong style="color: #4CAF50;">$${projectedValue.toFixed(0)}</strong>
                        </div>
                        <div style="color: #666;">
                            Potential gain: <span style="color: ${projectedGain >= 0 ? '#4CAF50' : '#F44336'};">
                            ${projectedGain >= 0 ? '+' : ''}$${projectedGain.toFixed(0)}
                            </span>
                        </div>
                    </div>
                `;
            }
            
            getPortfolioValue() {
                return Object.values(this.portfolio).reduce((sum, value) => sum + value, 0);
            }
            
            calculateRisk() {
                const totalValue = this.getPortfolioValue();
                if (totalValue === 0) return 'Low';
                
                let riskScore = 0;
                Object.keys(this.portfolio).forEach(investment => {
                    const weight = this.portfolio[investment] / totalValue;
                    const risk = this.investmentData[investment].risk;
                    const riskValue = risk === 'low' ? 1 : risk === 'medium' ? 2 : 3;
                    riskScore += weight * riskValue;
                });
                
                return riskScore < 1.5 ? 'Low' : riskScore < 2.5 ? 'Medium' : 'High';
            }
            
            updateDisplay() {
                document.getElementById('totalMoney').textContent = `$${this.cash.toFixed(0)}`;
                
                const portfolioValue = this.getPortfolioValue();
                document.getElementById('portfolioValue').textContent = `$${portfolioValue.toFixed(0)}`;
                
                const totalReturn = portfolioValue - this.totalInvested;
                document.getElementById('totalReturn').textContent = 
                    `${totalReturn >= 0 ? '+' : ''}$${totalReturn.toFixed(0)}`;
                document.getElementById('totalReturn').style.color = totalReturn >= 0 ? '#4CAF50' : '#F44336';
                
                document.getElementById('riskLevel').textContent = this.calculateRisk();
                
                this.updatePortfolioBreakdown();
                this.updatePortfolioPie();
                this.updateTimeframeResults();
            }
            
            updatePortfolioBreakdown() {
                const breakdown = document.getElementById('portfolioBreakdown');
                const totalValue = this.getPortfolioValue();
                
                if (totalValue === 0) {
                    breakdown.innerHTML = '<p style="color: #666; text-align: center;">No investments yet</p>';
                    return;
                }
                
                let html = '';
                Object.keys(this.portfolio).forEach(investment => {
                    const value = this.portfolio[investment];
                    const percentage = ((value / totalValue) * 100).toFixed(1);
                    const data = this.investmentData[investment];
                    
                    html += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding: 8px; background: #f8f9fa; border-radius: 5px;">
                            <span>${data.name}</span>
                            <span><strong>$${value.toFixed(0)}</strong> (${percentage}%)</span>
                        </div>
                    `;
                });
                
                breakdown.innerHTML = html;
            }
            
            updatePortfolioPie() {
                const canvas = document.querySelector('#portfolioPie canvas');
                const ctx = canvas.getContext('2d');
                const centerX = 100;
                const centerY = 100;
                const radius = 80;
                
                ctx.clearRect(0, 0, 200, 200);
                
                const totalValue = this.getPortfolioValue();
                if (totalValue === 0) {
                    ctx.fillStyle = '#e0e0e0';
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    ctx.fill();
                    return;
                }
                
                let currentAngle = 0;
                Object.keys(this.portfolio).forEach(investment => {
                    const value = this.portfolio[investment];
                    const percentage = value / totalValue;
                    const sliceAngle = percentage * 2 * Math.PI;
                    
                    ctx.fillStyle = this.investmentData[investment].color;
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                    ctx.closePath();
                    ctx.fill();
                    
                    currentAngle += sliceAngle;
                });
            }
            
            showInvestmentTip(investment) {
                const data = this.investmentData[investment];
                const tips = {
                    'savings': "Savings accounts are the safest place for your money, but they grow slowly.",
                    'bonds': "Bonds are like lending money to the government - they're very safe and pay steady interest.",
                    'index-funds': "Index funds let you own tiny pieces of hundreds of companies all at once!",
                    'reits': "REITs let you invest in real estate without buying a whole building.",
                    'large-cap-stocks': "Large company stocks are shares in big, well-known companies like Apple or Google.",
                    'small-cap-stocks': "Small company stocks can grow fast, but they're riskier than big companies.",
                    'crypto': "Cryptocurrency is digital money that can change value very quickly - very risky!"
                };
                
                this.showTip(tips[investment]);
            }
            
            showRandomTip() {
                const tip = this.educationalTips[Math.floor(Math.random() * this.educationalTips.length)];
                this.showTip(tip);
            }
            
            showTip(tip) {
                document.getElementById('educationalTip').textContent = tip;
            }
        }
        
        // Global functions
        function setAmount(amount) {
            document.getElementById('investmentAmount').value = amount;
            window.soundManager.play('click');
        }
        
        function investInSelected() {
            game.investInSelected();
        }
        
        function sellInvestment() {
            game.sellInvestment();
        }
        
        function rebalancePortfolio() {
            game.rebalancePortfolio();
        }
        
        function nextMonth() {
            game.nextMonth();
        }
        
        function setTimeframe(timeframe) {
            game.setTimeframe(timeframe);
        }
        
        // Initialize game
        let game;
        window.onload = () => {
            setTimeout(() => {
                game = new InvestmentPortfolioGame();
            }, 100);
        };
    </script>
</body>
</html>