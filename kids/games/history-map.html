<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Historical Land of Israel Map - Educational Timeline | Jerusalem Hills Kids</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="Explore the historical timeline of the Land of Israel through interactive maps. Educational journey from ancient times to modern day for kids ages 8-15.">
    <meta name="keywords" content="Israel history, historical maps, biblical history, ancient civilizations, educational timeline, kids history, interactive learning">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://jerusalemhills.com/kids/games/history-map.html">

    <!-- Open Graph -->
    <meta property="og:title" content="Historical Land of Israel Map - Educational Timeline">
    <meta property="og:description" content="Explore the historical timeline of the Land of Israel through interactive maps. Educational journey from ancient times to modern day.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jerusalemhills.com/kids/games/history-map.html">

    <!-- Favicon -->
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href="../assets/css/game.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Sound Manager -->
    <script src="../assets/js/sound-manager.js"></script>

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Game",
      "name": "Historical Land of Israel Map",
      "description": "Interactive educational timeline showing the historical development of the Land of Israel",
      "audience": {
        "@type": "PeopleAudience",
        "suggestedMinAge": 8,
        "suggestedMaxAge": 15
      },
      "educationalUse": "History education",
      "educationalLevel": "Elementary and Middle School",
      "isAccessibleForFree": true,
      "interactivityType": "active",
      "learningResourceType": "interactive map"
    }
    </script>

    <style>
        .map-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sidebar {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow-y: auto;
            position: sticky;
            top: 20px;
        }

        .sidebar h3 {
            color: #8B4513;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #8B4513;
            padding-bottom: 10px;
        }

        .historical-context {
            font-size: 0.9em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 20px;
        }

        .key-events {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .key-events h4 {
            color: #8B4513;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .key-events ul {
            margin: 0;
            padding-left: 20px;
        }

        .key-events li {
            margin-bottom: 5px;
            font-size: 0.85em;
        }

        .transition-info {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #2196F3;
        }

        .transition-info h4 {
            color: #1976D2;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .map-display {
            width: 100%;
            max-width: 600px;
            height: 500px;
            border: 3px solid #8B4513;
            border-radius: 15px;
            background: #F5E6D3;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .map-svg {
            width: 100%;
            height: 100%;
        }

        .timeline-controls {
            width: 100%;
            max-width: 600px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .timeline-slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin: 20px 0;
            -webkit-appearance: none;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .timeline-slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .period-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            transition: all 0.3s ease;
        }

        .period-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .period-description {
            font-size: 1em;
            line-height: 1.6;
            text-align: center;
        }

        .period-years {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            color: #FFD700;
            margin-bottom: 10px;
        }

        .timeline-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.8em;
            color: #666;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #333;
        }

        .territory {
            transition: all 0.5s ease;
            cursor: pointer;
        }

        .territory:hover {
            opacity: 0.8;
            stroke-width: 2;
        }

        .city-marker {
            fill: #333;
            stroke: white;
            stroke-width: 1;
            transition: all 0.3s ease;
        }

        .city-marker:hover {
            r: 6;
            fill: #ff6f61;
        }

        .city-label {
            font-size: 12px;
            fill: #333;
            text-anchor: middle;
            pointer-events: none;
        }

        .quiz-section {
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-top: 20px;
            display: none;
        }

        .quiz-question {
            font-size: 1.2em;
            margin-bottom: 15px;
            text-align: center;
            color: #333;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .quiz-option {
            background: #f0f0f0;
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .quiz-option:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .quiz-option.correct {
            background: #d4edda;
            border-color: #4CAF50;
        }

        .quiz-option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .audio-toggle {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .audio-toggle.muted {
            background: #ccc;
        }


        .sound-attribution {
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 5px;
        }

        @media (max-width: 1024px) {
            .map-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .sidebar {
                order: 2;
                position: static;
                max-height: none;
            }
        }

        /* Enhanced mobile responsiveness */
        @media (max-width: 768px) {
            .map-display {
                height: 350px;
                margin: 10px 0;
            }
            
            .timeline-controls {
                padding: 15px;
                background: #f8f9fa;
                border-radius: 10px;
                margin: 10px 0;
            }
            
            .timeline-slider {
                height: 8px; /* Thicker slider for easier touch */
                border-radius: 4px;
            }
            
            .timeline-slider::-webkit-slider-thumb {
                width: 25px; /* Larger thumb for mobile */
                height: 25px;
            }
            
            .timeline-slider::-moz-range-thumb {
                width: 25px;
                height: 25px;
            }
            
            .control-buttons {
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .control-btn {
                padding: 12px 16px; /* Larger touch targets */
                font-size: 14px;
                min-height: 44px; /* iOS recommended touch target size */
                border-radius: 22px;
            }
            
            .legend {
                grid-template-columns: 1fr;
                font-size: 14px;
            }
            
            .sidebar {
                padding: 15px;
                font-size: 14px;
                line-height: 1.5;
            }
            
            .period-info {
                padding: 15px;
                text-align: center;
            }
            
            .period-years {
                font-size: 1.2em;
            }
            
            .period-title {
                font-size: 1.4em;
            }
            
            .period-description {
                font-size: 14px;
            }
            
            /* Touch-friendly quiz buttons */
            .quiz-option {
                padding: 16px;
                min-height: 44px;
                font-size: 14px;
            }
            
            /* Mobile audio controls */
            .audio-toggle {
                padding: 12px 20px;
                font-size: 16px;
                min-height: 44px;
            }
        }
        
        /* Extra small devices */
        @media (max-width: 480px) {
            .map-container {
                padding: 10px;
                gap: 10px;
            }
            
            .control-buttons {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .control-btn {
                font-size: 12px;
                padding: 10px;
            }
            
            .sidebar {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>🗺️ Historical Land of Israel Map</h1>
        <div class="game-nav">
            <a href="../index.html" class="nav-btn">Kids Home</a>
            <a href="math.html" class="nav-btn">Math Quest</a>
            <a href="subtraction.html" class="nav-btn">Subtraction Quest</a>
            <a href="multiplication.html" class="nav-btn">Multiplication Master</a>
        </div>
    </header>

    <main class="map-container">
        <div class="main-content">
            <div class="period-info" id="periodInfo">
                <div class="period-years" id="periodYears">1200 BCE</div>
                <div class="period-title" id="periodTitle">Canaanite Period</div>
                <div class="period-description" id="periodDescription">
                    The ancient land was inhabited by various Canaanite tribes and city-states.
                </div>
            </div>

        <div class="map-display">
            <svg class="map-svg" viewBox="0 0 400 500" id="mapSvg">
                <!-- Enhanced map with improved geography -->
                <defs>
                    <!-- Realistic water pattern -->
                    <pattern id="seaPattern" patternUnits="userSpaceOnUse" width="20" height="20">
                        <rect width="20" height="20" fill="#2980B9"/>
                        <circle cx="5" cy="5" r="1" fill="#3498DB" opacity="0.6"/>
                        <circle cx="15" cy="15" r="1" fill="#3498DB" opacity="0.6"/>
                        <path d="M0,20 Q10,10 20,20" stroke="#5DADE2" stroke-width="0.5" fill="none" opacity="0.8"/>
                    </pattern>
                    
                    <!-- Mountain pattern -->
                    <pattern id="mountainPattern" patternUnits="userSpaceOnUse" width="15" height="15">
                        <rect width="15" height="15" fill="#8D6E63"/>
                        <path d="M0,15 L7.5,5 L15,15" fill="#A1887F" opacity="0.7"/>
                        <path d="M0,15 L3,12 L6,15" fill="#6D4C41" opacity="0.5"/>
                        <path d="M9,15 L12,12 L15,15" fill="#6D4C41" opacity="0.5"/>
                    </pattern>
                    
                    <!-- Desert pattern -->
                    <pattern id="desertPattern" patternUnits="userSpaceOnUse" width="12" height="12">
                        <rect width="12" height="12" fill="#F4A460"/>
                        <circle cx="3" cy="3" r="0.5" fill="#DEB887" opacity="0.6"/>
                        <circle cx="9" cy="9" r="0.5" fill="#DEB887" opacity="0.6"/>
                        <circle cx="6" cy="8" r="0.3" fill="#D2B48C" opacity="0.8"/>
                    </pattern>
                    
                    <!-- Fertile plains pattern -->
                    <pattern id="plainsPattern" patternUnits="userSpaceOnUse" width="10" height="10">
                        <rect width="10" height="10" fill="#90EE90"/>
                        <circle cx="2" cy="2" r="0.5" fill="#228B22" opacity="0.4"/>
                        <circle cx="8" cy="8" r="0.5" fill="#228B22" opacity="0.4"/>
                        <path d="M0,5 Q5,3 10,5" stroke="#006400" stroke-width="0.3" opacity="0.6"/>
                    </pattern>
                    
                    <!-- City symbol -->
                    <g id="citySymbol">
                        <circle r="6" fill="#8B4513" stroke="#654321" stroke-width="1"/>
                        <rect x="-3" y="-4" width="2" height="6" fill="#DEB887"/>
                        <rect x="1" y="-4" width="2" height="6" fill="#DEB887"/>
                        <rect x="-1" y="-6" width="2" height="2" fill="#CD853F"/>
                    </g>
                </defs>
                
                <!-- Realistic Mediterranean coastline -->
                <path d="M0,0 L90,0 Q95,50 100,80 Q98,120 95,160 Q92,200 88,240 Q85,280 82,320 Q80,360 78,400 Q76,450 75,500 L0,500 Z" 
                      fill="url(#seaPattern)" stroke="#1B4F72" stroke-width="2"/>
                
                <!-- Realistic Dead Sea shape -->
                <ellipse cx="280" cy="320" rx="35" ry="80" fill="url(#seaPattern)" stroke="#1B4F72" stroke-width="2"/>
                
                <!-- Sea of Galilee (Lake Kinneret) -->
                <ellipse cx="250" cy="140" rx="18" ry="25" fill="url(#seaPattern)" stroke="#1B4F72" stroke-width="2"/>
                
                <!-- Jordan River - more realistic path -->
                <path d="M250,165 Q255,190 265,220 Q270,250 275,280 Q280,300 280,320" 
                      stroke="#2980B9" stroke-width="6" fill="none" opacity="0.8"/>
                
                <!-- Mountain ranges - Judean Hills -->
                <polygon points="120,180 180,160 220,180 260,200 280,240 260,280 220,300 180,280 140,260 120,220" 
                         fill="url(#mountainPattern)" stroke="#5D4037" stroke-width="1" class="territory" id="judeanHills"/>
                
                <!-- Galilee region -->
                <polygon id="galilee" points="100,80 320,80 320,180 280,180 250,165 200,170 150,160 100,140" 
                         fill="url(#plainsPattern)" stroke="#2E7D32" stroke-width="1" class="territory"/>
                
                <!-- Samarian Hills -->
                <polygon id="samaria" points="100,140 200,170 250,165 280,180 320,180 320,240 280,240 220,200 180,160 140,160 100,180" 
                         fill="url(#mountainPattern)" stroke="#5D4037" stroke-width="1" class="territory"/>
                
                <!-- Judean region -->
                <polygon id="judea" points="100,180 180,160 220,180 280,240 320,240 320,340 280,360 220,340 180,320 140,300 100,280" 
                         fill="url(#mountainPattern)" stroke="#5D4037" stroke-width="1" class="territory"/>
                
                <!-- Negev Desert -->
                <polygon id="negev" points="100,280 180,320 220,340 280,360 320,340 320,500 100,500" 
                         fill="url(#desertPattern)" stroke="#D4AC0D" stroke-width="1" class="territory"/>
                
                <!-- Coastal Plains -->
                <polygon id="coastalPlains" points="78,100 100,140 100,360 78,400" 
                         fill="url(#plainsPattern)" stroke="#2E7D32" stroke-width="1" class="territory"/>
                
                <!-- Enhanced Cities with better positioning -->
                <g id="cities">
                    <!-- Jerusalem - most important city -->
                    <g id="jerusalem" class="city-marker" transform="translate(200,220)">
                        <use href="#citySymbol" transform="scale(1.5)"/>
                        <circle r="12" fill="none" stroke="#FFD700" stroke-width="2" opacity="0.8"/>
                        <text x="0" y="25" class="city-label" text-anchor="middle" font-weight="bold" font-size="14">Jerusalem</text>
                    </g>
                    
                    <!-- Other major cities -->
                    <g id="bethlehem" class="city-marker" transform="translate(190,240)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Bethlehem</text>
                    </g>
                    
                    <g id="hebron" class="city-marker" transform="translate(180,280)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Hebron</text>
                    </g>
                    
                    <g id="jericho" class="city-marker" transform="translate(240,260)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Jericho</text>
                    </g>
                    
                    <g id="nazareth" class="city-marker" transform="translate(220,120)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Nazareth</text>
                    </g>
                    
                    <g id="capernaum" class="city-marker" transform="translate(260,130)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Capernaum</text>
                    </g>
                    
                    <g id="caesarea" class="city-marker" transform="translate(120,180)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Caesarea</text>
                    </g>
                    
                    <g id="gaza" class="city-marker" transform="translate(110,360)">
                        <use href="#citySymbol"/>
                        <text x="0" y="18" class="city-label" text-anchor="middle">Gaza</text>
                    </g>
                </g>
                
                <!-- Geographic labels -->
                <g id="geoLabels" font-family="serif" font-style="italic" opacity="0.7">
                    <text x="50" y="250" font-size="16" fill="#1B4F72" text-anchor="middle" transform="rotate(-90 50 250)">Mediterranean Sea</text>
                    <text x="300" y="320" font-size="12" fill="#1B4F72" text-anchor="middle">Dead Sea</text>
                    <text x="250" y="140" font-size="10" fill="#1B4F72" text-anchor="middle">Sea of Galilee</text>
                    <text x="265" y="240" font-size="10" fill="#1B4F72" text-anchor="middle" transform="rotate(-60 265 240)">Jordan River</text>
                    <text x="200" y="400" font-size="14" fill="#D4AC0D" text-anchor="middle">Negev Desert</text>
                    <text x="200" y="100" font-size="12" fill="#2E7D32" text-anchor="middle">Galilee</text>
                    <text x="180" y="160" font-size="11" fill="#5D4037" text-anchor="middle">Samaria</text>
                    <text x="200" y="200" font-size="11" fill="#5D4037" text-anchor="middle">Judea</text>
                </g>
            </svg>
        </div>

        <div class="timeline-controls">
            <div style="text-align: center; margin-bottom: 15px;">
                <strong>Historical Timeline Slider</strong>
            </div>
            
            <input type="range" 
                   id="timelineSlider" 
                   class="timeline-slider" 
                   min="0" 
                   max="19" 
                   value="0" 
                   step="1">
            
            <div class="timeline-markers">
                <span>1200 BCE</span>
                <span>Biblical</span>
                <span>Empires</span>
                <span>Modern</span>
                <span>2020 CE</span>
            </div>
        </div>

        <div class="control-buttons">
            <button class="control-btn" id="prevBtn">⬅️ Previous Era</button>
            <button class="control-btn" id="playBtn">▶️ Auto Play</button>
            <button class="control-btn" id="nextBtn">Next Era ➡️</button>
            <button class="control-btn" id="quizBtn">📝 Take Quiz</button>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #2980B9;"></div>
                <span>Water Bodies (Sea, Rivers)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #90EE90;"></div>
                <span>Fertile Plains & Valleys</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8D6E63;"></div>
                <span>Mountain Ranges & Hills</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #F4A460;"></div>
                <span>Desert Regions</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #8B4513;"></div>
                <span>Important Cities & Settlements</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #FFD700;"></div>
                <span>Jerusalem (Holy City)</span>
            </div>
        </div>

        <div class="quiz-section" id="quizSection">
            <div class="quiz-question" id="quizQuestion"></div>
            <div class="quiz-options" id="quizOptions"></div>
            <div id="quizResult" style="text-align: center; margin-top: 15px;"></div>
        </div>
        </div>

        <div class="sidebar">
            <h3>📚 Historical Context</h3>
            
            <div class="audio-controls">
                <button class="audio-toggle" id="audioToggle">🔊 Sound On</button>
                <span style="font-size: 0.9em; color: #666;">Automatic period sounds</span>
            </div>
            
            <div class="historical-context" id="historicalContext">
                Select a period to learn about the historical transitions and key events that shaped the land.
            </div>
            
            <div class="key-events" id="keyEvents" style="display: none;">
                <h4>🗝️ Key Events</h4>
                <ul id="eventsList"></ul>
            </div>
            
            <div class="transition-info" id="transitionInfo" style="display: none;">
                <h4>🔄 What Changed?</h4>
                <p id="transitionText"></p>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Jerusalem Hills Kids - Educational & Historical</p>
        <p><small>Historical content for educational purposes only, based on best available knowledge with respect for every soul • <a href="../educational-disclaimer.html" style="color: #87CEEB; text-decoration: underline;">Community feedback & corrections welcome</a></small></p>
        <p><a href="../index.html">Back to Kids Zone</a></p>
    </footer>

    <script>
        // Historical periods data based on archaeological and historical evidence
        const historicalPeriods = [
            {
                years: "3500-1200 BCE",
                title: "Canaanite Period & Mediterranean Bronze Age",
                description: "Ancient settlements like Tell es-Sakan (3500 BCE) show continuous habitation. The land was a crossroads of Mediterranean civilizations - Egyptian, Hittite, and various Canaanite cultures. This era saw the rise of Mediterranean trade networks that would define the region for millennia.",
                colors: { north: "#8FBC8F", central: "#DEB887", south: "#F4A460" },
                context: "The Eastern Mediterranean was humanity's first 'global highway' for trade and cultural exchange. Gaza and other coastal cities became vital links connecting Egypt, Mesopotamia, and the emerging Hittite Empire. The land hosted diverse Canaanite peoples: Hittites (master ironworkers), Jebusites (Jerusalem's original inhabitants), Amorites (mountain strongholds), Girgashites, Perizzites (rural communities), and Hivites. Trade routes carried gold, spices, cedar wood, and bronze technology across vast distances.",
                keyEvents: [
                    "3500 BCE: Tell es-Sakan built - one of world's earliest fortified cities",
                    "2500 BCE: Phoenician maritime culture emerges from Canaanite roots", 
                    "2000 BCE: Tell el-Ajjul established, massive gold hoard shows Mediterranean wealth",
                    "1650 BCE: Hittite Empire expands, introducing iron technology",
                    "1550-1200 BCE: Egyptian New Kingdom control, Mediterranean trade flourishes",
                    "Complex Bronze Age societies develop sophisticated trade networks"
                ],
                transition: "The Bronze Age Collapse (c. 1200 BCE) was a perfect storm: severe drought, possible pandemic, technological changes, and Sea Peoples migrations fundamentally transformed Mediterranean civilization. Most cities survived but complex trade networks collapsed, ushering in the Iron Age.",
                audio: {
                    file: "sounds/ancient-winds.m4a",
                    description: "Desert winds and distant hammering of bronze tools",
                    attribution: "Ancient crafting sounds mixed with Middle Eastern winds",
                    educational: "🏺 Did you know? Bronze Age craftsmen heated copper and tin together to create bronze - one of humanity's first metal alloys! The ancient land was home to many peoples: Hittites (known for iron weapons), Jebusites (who controlled Jerusalem), Amorites (mountain dwellers), Girgashites, Perizzites (rural peoples), and Hivites. Each had their own customs, crafts, and settlements throughout the region."
                }
            },
            {
                years: "1200-600 BCE",
                title: "Sea Peoples & Iron Age Mediterranean",
                description: "The mysterious Sea Peoples migrated across the Eastern Mediterranean, establishing the Philistine Pentapolis (Gaza, Ashkelon, Ashdod, Ekron, Gath). This era marked the transition from Bronze to Iron Age and new Mediterranean power dynamics.",
                colors: { north: "#4169E1", central: "#8FBC8F", south: "#9370DB" },
                context: "The Bronze Age Collapse created a power vacuum that Sea Peoples filled. Likely originating from the Greek Aegean, they resettled with Egyptian permission along Mediterranean coasts. While complex Bronze Age trade networks collapsed, new Iron Age societies emerged. Phoenicians (evolved from Canaanites) became the Mediterranean's master traders, developing the first alphabet and establishing colonies from Cyprus to Spain. The word 'Palestine' derives from 'Philistine.'",
                keyEvents: [
                    "c. 1200 BCE: Sea Peoples migrations following Bronze Age collapse",
                    "Philistine Pentapolis controls southern coastal plain",
                    "1200-800 BCE: Phoenician trade networks peak, colonies established",
                    "Iron technology spreads, replacing bronze tools and weapons",
                    "Biblical period: Samson, David vs. Goliath stories set in this era",
                    "Phoenicians develop alphabet, influencing Greek and Latin scripts",
                    "600 BCE: Babylonian campaigns end Philistine independence"
                ],
                transition: "Babylonian expansion under Nebuchadnezzar integrated remaining Philistine territories into the Neo-Babylonian Empire, while Mediterranean trade continued under Phoenician and Greek influence.",
                audio: {
                    file: "sounds/sea-peoples.m4a",
                    description: "Mediterranean waves and ancient Greek-style flutes",
                    attribution: "Sea sounds with ancient wind instruments",
                    educational: "🌊 Fun Fact! The Philistines were 'Sea Peoples' who probably came from the Greek islands. They gave Palestine its name and were master seafarers. The flute sounds represent their cultural connection to the Mediterranean world, and Gaza was their southernmost port city!"
                }
            },
            {
                years: "1000-920 BCE",
                title: "United Kingdom vs Philistines",
                description: "While biblical sources describe Kings Saul, David, and Solomon unifying Israelite tribes, Gaza remained under Philistine control. Archaeological evidence suggests the Israelite kingdom was more modest than described.",
                colors: { north: "#9370DB", central: "#9370DB", south: "#9370DB" },
                context: "Biblical stories tell of conflicts between Israelite heroes (Samson, David) and Philistines. The land was inhabited by many peoples: Israelites controlled the highlands, Philistines the coast, while Jebusites held Jerusalem until David's conquest. Other Canaanite groups like Hittites, Amorites, and Hivites maintained their territories.",
                keyEvents: [
                    "c. 1000 BCE: David conquers Jerusalem from the Jebusites",
                    "Jerusalem becomes capital of Kingdom of Judah",
                    "Biblical period: Samson's conflicts with Philistines",
                    "David vs. Goliath of Gath (Philistine city)",
                    "Various peoples coexist: Israelites, Philistines, Jebusites, Hittites, others",
                    "Gaza remains under Philistine control"
                ],
                transition: "The Philistines appear to have maintained independence at Gaza throughout this period, particularly as their southernmost stronghold."
            },
            {
                years: "920-722 BCE",
                title: "Divided Kingdoms",
                description: "After Solomon's death, the kingdom split into Israel (north) and Judah (south). Israel was more prosperous with 160,000 people across 500 settlements by the 8th century BCE.",
                colors: { north: "#4169E1", central: "#DC143C", south: "#DC143C" },
                context: "Political and religious tensions led to the split. The northern Kingdom of Israel was larger and more prosperous, while Judah centered around Jerusalem remained smaller but culturally significant.",
                keyEvents: [
                    "930 BCE: Kingdom divides after Solomon's death",
                    "Capital of Israel: Samaria; Capital of Judah: Jerusalem",
                    "Both kingdoms faced Assyrian pressure",
                    "Israel developed into a regional power"
                ],
                transition: "Civil war and tribal tensions led to permanent division of the united monarchy."
            },
            {
                years: "722-586 BCE",
                title: "Assyrian Conquest",
                description: "The Kingdom of Israel was destroyed by Assyria in 722 BCE. Sargon II deported 27,290 inhabitants to Mesopotamia. Judah survived as an Assyrian vassal.",
                colors: { north: "#8B0000", central: "#DC143C", south: "#DC143C" },
                context: "The Assyrian Empire was expanding westward. Israel's location made it a strategic target. The deportation policy prevented rebellions and is the origin of the 'Lost Ten Tribes' tradition.",
                keyEvents: [
                    "722 BCE: Fall of Samaria to Assyrian forces",
                    "Mass deportation of Israelites to Mesopotamia",
                    "Judah becomes Assyrian vassal state",
                    "Foreign populations settled in former Israel"
                ],
                transition: "Assyrian military superiority and siege warfare ended the northern kingdom permanently.",
                audio: {
                    file: "sounds/assyrian-march.m4a",
                    description: "Distant war drums and marching armies",
                    attribution: "Ancient military march sounds",
                    educational: "⚔️ Historical Note: The Assyrians were the ancient world's first great military empire! They used iron weapons, cavalry, and siege engines. When they conquered a city, they often relocated entire populations to prevent rebellions - that's why 27,290 Israelites were moved to Mesopotamia."
                }
            },
            {
                years: "586-538 BCE",
                title: "Babylonian Exile",
                description: "600 BCE: Babylonians destroyed the last Philistine cities as part of power struggle with Egypt. Archaeological record shows 90% population decrease in entire Southern Levant.",
                colors: { north: "#8B4513", central: "#8B4513", south: "#8B4513" },
                context: "Around 600 BCE, Nebuchadnezzar's campaigns were part of larger power struggle between Babylon and Egypt. Gaza was almost certainly destroyed at this point along with Jerusalem and other cities.",
                keyEvents: [
                    "600 BCE: Philistines suddenly disappear from history",
                    "586 BCE: Destruction of Jerusalem by Nebuchadnezzar",
                    "90% population decrease across Southern Levant",
                    "End of independent kingdoms in the region"
                ],
                transition: "Persian conquest allowed rebuilding and return of some exiles, creating mixed population in rebuilt cities."
            },
            {
                years: "538-332 BCE",
                title: "Persian Mediterranean Empire",
                description: "The mighty Persian Achaemenid Empire transformed the Mediterranean into a connected world system. Under Cyrus, Darius, and Xerxes, Persian rule extended from India to Greece, creating the first true world empire with Mediterranean trade networks.",
                colors: { north: "#FF6347", central: "#FF6347", south: "#FF6347" },
                context: "The Persian Empire revolutionized Mediterranean governance through religious tolerance and cultural pluralism. The famous Royal Road connected Mediterranean ports to Central Asia, enabling unprecedented trade flows. Persian satraps administered diverse populations while Phoenician allies maintained crucial naval operations. This created a Mediterranean-wide commerce network connecting cultures from Spain to India, with the Land of Israel as a vital crossroads.",
                keyEvents: [
                    "539 BCE: Cyrus the Great's tolerant policies enable Jewish return",
                    "Persian Royal Road connects Mediterranean to Central Asia",
                    "Phoenician cities become Persian naval allies and trading partners",
                    "522-486 BCE: Darius I's satrap system organizes Mediterranean provinces",
                    "499-449 BCE: Greco-Persian Wars reshape Mediterranean politics",
                    "Persian-sponsored Mediterranean trade networks flourish",
                    "Cultural synthesis: Persian, Greek, and Levantine influences blend"
                ],
                transition: "Alexander the Great's lightning conquest (334-323 BCE) ended Persian rule, but Hellenistic kingdoms inherited Persian administrative genius and Mediterranean trade networks, creating a new fusion of Greek and Persian imperial traditions."
            },
            {
                years: "332-63 BCE",
                title: "Greek/Hellenistic Period",
                description: "Alexander the Great conquered the region, bringing Greek culture and influence.",
                colors: { north: "#00CED1", central: "#00CED1", south: "#00CED1" }
            },
            {
                years: "63 BCE-324 CE",
                title: "Roman Mediterranean Empire",
                description: "Rome achieved the ultimate Mediterranean dream: 'Mare Nostrum' (Our Sea). Under Augustus, Hadrian, and others, Romans transformed the Mediterranean into a unified economic and cultural space. Jerusalem's destruction and rebirth as Aelia Capitolina exemplified Roman imperial transformation.",
                colors: { north: "#B22222", central: "#B22222", south: "#B22222" },
                context: "For the first (and last) time in history, the entire Mediterranean came under single political control. Roman engineering connected distant shores through roads, aqueducts, and shipping routes. The Land of Israel became a strategic province linking Egypt, Anatolia, and the Euphrates frontier. Roman policies created unprecedented Mediterranean unity: standardized currency, legal systems, and urban planning from Britain to Babylonia. The destruction and pagan rebuilding of Jerusalem reflected Rome's approach to local traditions.",
                keyEvents: [
                    "63 BCE: Pompey integrates region into Roman Mediterranean system",
                    "27 BCE-14 CE: Augustus creates Pax Romana across Mediterranean",
                    "70 CE: Second Temple destroyed - Jerusalem's role as Jewish center ends",
                    "70-130 CE: Jerusalem ruins reflect broader Roman urban planning",
                    "130 CE: Hadrian's 'Aelia Capitolina' represents Roman Mediterranean cosmopolitanism",
                    "Roman infrastructure: roads, ports, aqueducts transform regional economy",
                    "Mediterranean-wide trade brings unprecedented prosperity and cultural exchange"
                ],
                transition: "Constantine's conversion (312 CE) and new capital Constantinople (330 CE) shifted Roman power eastward, beginning the Byzantine transformation of Mediterranean civilization toward Christianity and Greek culture.",
                audio: {
                    file: "sounds/roman-forum.m4a",
                    description: "Distant Latin voices with marketplace ambience",
                    attribution: "Roman administrative sounds and urban activity",
                    educational: "🏛️ Amazing Fact: For nearly 200 years (130-326 CE), Jerusalem was a pagan Roman city called 'Aelia Capitolina' where Jews were completely banned! A temple to Jupiter stood exactly where the Jewish Temple once was. This shows how dramatically cities could change in ancient times!"
                }
            },
            {
                years: "324-638 CE",
                title: "Byzantine Period",
                description: "395 CE: Saint Porphyrius became Bishop of Gaza, destroyed pagan temples, established Christianity. For first time, Jews frequently visited Gaza since they were banned from Jerusalem (135 CE).",
                colors: { north: "#9932CC", central: "#9932CC", south: "#9932CC" },
                context: "Gaza became Christian city as Christianity was now state religion of Rome. Jewish pilgrims visiting land of ancestors used Gaza as 'next best thing' to Jerusalem, from which they were banned.",
                keyEvents: [
                    "395 CE: Saint Porphyrius becomes Bishop of Gaza",
                    "Destruction of pagan temples, building of churches",
                    "c. 500 CE: Synagogue built with Byzantine mosaic of King David",
                    "Gaza becomes destination for Jewish pilgrims"
                ],
                transition: "634 CE: Battle of Ajnadayn between Muslim and Roman armies - Muslims won decisively and turned attention to Gaza."
            },
            {
                years: "637-1099 CE",
                title: "Early Islamic Period",
                description: "637 CE: Muslims captured Gaza after 3-year siege, occupying peacefully - killed enemy soldiers, not civilians. Gaza became part of Jund Filastin district of Arab Empire for 462 years.",
                colors: { north: "#228B22", central: "#228B22", south: "#228B22" },
                context: "636 CE: The most important turning point in Jerusalem's history! Caliph Umar conquered Jerusalem, making it a primarily Muslim city for first time ever. 691 CE: Dome of the Rock built on exact site where Jewish Temple once stood, near Church of Holy Sepulchre.",
                keyEvents: [
                    "634 CE: Battle of Ajnadayn - Muslims defeat Romans",
                    "636 CE: Caliph Umar conquers Jerusalem - turning point!",
                    "637 CE: Gaza captured after 3-year siege",
                    "691 CE: Dome of the Rock built on Temple Mount",
                    "Freedom of religion granted to Jews and Christians",
                    "Churches converted to mosques, gradual Islamic conversion"
                ],
                transition: "1099: Crusaders captured Jerusalem and established European-style kingdom, causing most Gaza inhabitants to flee to Egypt or Arabia.",
                audio: {
                    file: "sounds/islamic-call.m4a",
                    description: "Call to prayer echoing across ancient city",
                    attribution: "Traditional Islamic call to prayer ambience",
                    educational: "🕌 Amazing History: 691 CE - The Dome of the Rock was built on the exact spot where the Jewish Temple once stood! It covers the Foundation Stone, believed to be where the Holy of Holies was located. Below is the mysterious 'Well of Souls' chamber. The Dome stands next to Al-Aqsa Mosque and remains Jerusalem's most famous landmark today!"
                }
            },
            {
                years: "1099-1187 CE",
                title: "Crusader Period",
                description: "European Crusaders established kingdoms in the Holy Land.",
                colors: { north: "#8B0000", central: "#FFD700", south: "#8B0000" }
            },
            {
                years: "1187-1517 CE",
                title: "Ayyubid/Mamluk Period",
                description: "Islamic dynasties regained control after defeating the Crusaders.",
                colors: { north: "#006400", central: "#006400", south: "#006400" }
            },
            {
                years: "1517-1917 CE",
                title: "Ottoman Empire",
                description: "The Ottoman Turks ruled for 400 years. The region was divided into administrative districts, with gradual decline in later centuries and increased European influence.",
                colors: { north: "#8B0000", central: "#8B0000", south: "#8B0000" },
                context: "The Ottoman Empire brought stability and Islamic law. Jerusalem's importance grew as a pilgrimage site. In the 19th century, European powers gained influence and Jewish immigration began.",
                keyEvents: [
                    "1517: Ottomans defeat Mamluks, gain control",
                    "Administrative reorganization into districts",
                    "19th century: European influence increases",
                    "Late 1800s: First waves of Jewish immigration (Aliyah)"
                ],
                transition: "World War I and Ottoman defeat opened the region to British control and international intervention.",
                audio: {
                    file: "sounds/ottoman-oud.m4a",
                    description: "Traditional Turkish oud music with distant marketplace sounds",
                    attribution: "Ottoman-era traditional music ambience",
                    educational: "🎵 Musical History: The oud is an ancient stringed instrument that's the ancestor of the guitar! During Ottoman rule, Gaza was larger and more important than Jerusalem. The marketplace sounds reflect the spice trade routes that made Gaza wealthy - connecting Asia, Africa, and Europe!"
                }
            },
            {
                years: "1917-1948 CE",
                title: "British Mandate",
                description: "Britain governed under League of Nations mandate. The 1917 Balfour Declaration supported a Jewish homeland. Large-scale Jewish immigration occurred, especially in the 1930s.",
                colors: { north: "#4682B4", central: "#4682B4", south: "#4682B4" },
                context: "The British Mandate incorporated the Balfour Declaration supporting Jewish national home. Rising tensions between Arab and Jewish populations led to violence and competing national movements.",
                keyEvents: [
                    "1917: Balfour Declaration issued by Britain",
                    "1922-1947: British Mandate period",
                    "1930s: Increased Jewish immigration fleeing Nazi persecution",
                    "1937: Arab rebellion against British rule and immigration"
                ],
                transition: "UN Partition Plan of 1947 attempted to resolve competing national claims through territorial division."
            },
            {
                years: "1948 CE",
                title: "Independence & Partition",
                description: "May 14, 1948: Israel declared independence. Arab states invaded the next day. The war resulted in Israeli control of more territory than allocated by UN partition, and 700,000 Palestinian refugees.",
                colors: { north: "#0047AB", central: "#0047AB", south: "#DEB887" },
                context: "The 1947 UN Partition Plan was accepted by Jewish leaders but rejected by Arab states. David Ben-Gurion proclaimed Israeli independence as British forces withdrew.",
                keyEvents: [
                    "November 29, 1947: UN Resolution 181 (Partition Plan)",
                    "May 14, 1948: Israel declares independence",
                    "May 15, 1948: Arab states invade",
                    "1949: Armistice agreements establish new borders"
                ],
                transition: "End of British Mandate led to first Arab-Israeli war and establishment of two competing national entities."
            },
            {
                years: "1967 CE",
                title: "Six-Day War",
                description: "June 5-10, 1967: Israel captured West Bank, East Jerusalem, Gaza Strip, Sinai Peninsula, and Golan Heights. Second exodus of 500,000 Palestinians occurred.",
                colors: { north: "#0047AB", central: "#0047AB", south: "#0047AB" },
                context: "Rising tensions between Israel, Egypt, and Syria led to war. Israel's decisive victory dramatically changed regional geography and created ongoing occupation issues.",
                keyEvents: [
                    "June 5: Israel launches preemptive strikes",
                    "June 7: Jerusalem reunified under Israeli control",
                    "June 10: Ceasefire declared",
                    "UN Resolution 242 calls for withdrawal from occupied territories"
                ],
                transition: "Overwhelming Israeli military victory expanded territory but created new demographic and political challenges."
            },
            {
                years: "1978-1982 CE",
                title: "Camp David Accords",
                description: "Peace agreement with Egypt. Sinai Peninsula returned to Egypt.",
                colors: { north: "#0047AB", central: "#0047AB", south: "#32CD32" }
            },
            {
                years: "1993-1995 CE",
                title: "Oslo Accords",
                description: "Secret negotiations in Norway led to mutual recognition between Israel and PLO. Palestinian Authority established with limited self-governance in parts of West Bank and Gaza.",
                colors: { north: "#0047AB", central: "#90EE90", south: "#228B22" },
                context: "The First Intifada (1987) and international pressure led to breakthrough negotiations. Arafat, Rabin, and Peres won Nobel Peace Prize in 1994.",
                keyEvents: [
                    "September 1993: Oslo I Accords signed",
                    "Mutual recognition between Israel and PLO",
                    "1995: Oslo II expands Palestinian self-rule",
                    "Establishment of Palestinian Authority"
                ],
                transition: "Secret diplomacy breakthrough aimed to resolve conflict through gradual Palestinian autonomy and eventual final status negotiations."
            },
            {
                years: "2005 CE",
                title: "Gaza Disengagement",
                description: "Israel withdrew settlements and military from Gaza Strip.",
                colors: { north: "#0047AB", central: "#90EE90", south: "#FF6347" }
            },
            {
                years: "2020 CE",
                title: "Modern Day",
                description: "Complex situation with Israeli control, Palestinian Authority in parts of West Bank, Hamas in Gaza. Ongoing diplomatic efforts include regional normalization agreements and international mediation.",
                colors: { north: "#0047AB", central: "#90EE90", south: "#FF6347" },
                context: "After the Second Intifada (2000-2005), various peace initiatives continued. Regional dynamics changed with Arab Spring and Abraham Accords normalizing Israel-Arab relations.",
                keyEvents: [
                    "2005: Israeli disengagement from Gaza",
                    "2007: Hamas takes control of Gaza",
                    "2020: Abraham Accords with UAE, Bahrain",
                    "Ongoing: Various diplomatic initiatives"
                ],
                transition: "Current period marked by status quo management, regional integration, and continued search for sustainable peace solutions."
            }
        ];

        // Quiz questions based on historical research
        const quizQuestions = [
            {
                question: "Which ancient people controlled Gaza from 1200-600 BCE and gave Palestine its name?",
                options: ["Canaanites", "Philistines", "Egyptians", "Israelites"],
                correct: 1
            },
            {
                question: "What does the ancient name 'Ghazzat' mean?",
                options: ["The holy city", "The strong city", "The trading post", "The coastal city"],
                correct: 1
            },
            {
                question: "According to Matt Baker's research, what happened to 90% of the Southern Levant's population around 600 BCE?",
                options: ["They moved to Egypt", "Population decreased dramatically", "They joined the Babylonian army", "They built new cities"],
                correct: 1
            },
            {
                question: "Why is it difficult to identify a single 'indigenous' group for this region?",
                options: ["Records were lost", "Too many groups mixed over thousands of years", "Only recent history is known", "All groups left the area"],
                correct: 1
            },
            {
                question: "Who was the only Jewish power to control Gaza between the Philistines and 1948?",
                options: ["King David", "Alexander Jannaeus (Hasmonean)", "Herod the Great", "Bar Kokhba"],
                correct: 1
            },
            {
                question: "What was unique about the Muslim conquest of Gaza in 637 CE?",
                options: ["They destroyed the city", "They occupied it peacefully", "They built new walls", "They renamed it"],
                correct: 1
            },
            {
                question: "Which ancient Canaanite people controlled Jerusalem before King David?",
                options: ["Hittites", "Jebusites", "Amorites", "Girgashites"],
                correct: 1
            },
            {
                question: "The Hittites were among the first ancient peoples known for making weapons from which metal?",
                options: ["Bronze", "Copper", "Iron", "Gold"],
                correct: 2
            },
            {
                question: "What was the pagan Roman name for Jerusalem (130-326 CE) when Jews were banned?",
                options: ["Aelia Capitolina", "Caesarea", "Antioch", "Byzantium"],
                correct: 0
            },
            {
                question: "In what year was the famous Dome of the Rock built on the Temple Mount?",
                options: ["636 CE", "691 CE", "720 CE", "750 CE"],
                correct: 1
            },
            {
                question: "According to Matt Baker's research, which empire controlled Jerusalem the longest?",
                options: ["Ottoman Empire", "Roman/Byzantine Empire", "Arab Empire", "British Empire"],
                correct: 1
            }
        ];

        // Game state
        let currentPeriod = 0;
        let isPlaying = false;
        let playInterval;
        let currentQuizQuestion = 0;
        
        // Audio system
        let currentAudio = null;
        let audioEnabled = true;
        let audioVolume = 0.3;

        // DOM elements
        const slider = document.getElementById('timelineSlider');
        const periodInfo = document.getElementById('periodInfo');
        const periodYears = document.getElementById('periodYears');
        const periodTitle = document.getElementById('periodTitle');
        const periodDescription = document.getElementById('periodDescription');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const playBtn = document.getElementById('playBtn');
        const quizBtn = document.getElementById('quizBtn');
        const quizSection = document.getElementById('quizSection');
        const territories = document.getElementById('territories');
        const audioToggle = document.getElementById('audioToggle');

        // Initialize
        function init() {
            updateDisplay();
            setupEventListeners();
            soundManager.play('start');
        }

        function setupEventListeners() {
            slider.addEventListener('input', (e) => {
                currentPeriod = parseInt(e.target.value);
                updateDisplay();
                soundManager.play('select');
            });

            prevBtn.addEventListener('click', () => {
                if (currentPeriod > 0) {
                    currentPeriod--;
                    slider.value = currentPeriod;
                    updateDisplay();
                    soundManager.play('select');
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentPeriod < historicalPeriods.length - 1) {
                    currentPeriod++;
                    slider.value = currentPeriod;
                    updateDisplay();
                    soundManager.play('select');
                }
            });

            playBtn.addEventListener('click', toggleAutoPlay);
            quizBtn.addEventListener('click', showQuiz);
            audioToggle.addEventListener('click', toggleAudio);
        }

        // Audio Management Functions
        function toggleAudio() {
            audioEnabled = !audioEnabled;
            
            if (audioEnabled) {
                audioToggle.textContent = '🔊 Sound On';
                audioToggle.classList.remove('muted');
                playPeriodAudio(currentPeriod);
            } else {
                audioToggle.textContent = '🔇 Sound Off';
                audioToggle.classList.add('muted');
                stopCurrentAudio();
            }
        }

        function playPeriodAudio(periodIndex) {
            if (!audioEnabled) return;
            
            const period = historicalPeriods[periodIndex];
            if (!period.audio) return;
            
            // Stop current audio
            stopCurrentAudio();
            
            // Use sound manager for atmospheric sounds based on period
            const soundType = getPeriodSoundType(periodIndex);
            if (soundType) {
                soundManager.play(soundType);
            }
            
            // Update audio attribution
            updateAudioAttribution(period.audio);
        }
        
        function getPeriodSoundType(periodIndex) {
            // Map different historical periods to appropriate sound types
            const period = historicalPeriods[periodIndex];
            
            if (period.title.includes('Canaanite') || period.title.includes('Bronze Age')) {
                return 'start'; // Ancient beginning sounds
            } else if (period.title.includes('Sea Peoples') || period.title.includes('Philistine')) {
                return 'hint'; // Mediterranean sounds
            } else if (period.title.includes('Assyrian') || period.title.includes('War')) {
                return 'milestone'; // Military/conquest sounds
            } else if (period.title.includes('Persian') || period.title.includes('Greek')) {
                return 'next'; // Imperial transition sounds
            } else if (period.title.includes('Roman') || period.title.includes('Byzantine')) {
                return 'correct'; // Administrative empire sounds
            } else if (period.title.includes('Islamic') || period.title.includes('Ottoman')) {
                return 'match'; // Cultural flowering sounds
            } else if (period.title.includes('Crusader') || period.title.includes('conflict')) {
                return 'no-match'; // Conflict period sounds
            } else if (period.title.includes('Modern') || period.title.includes('Independence')) {
                return 'victory'; // Modern achievement sounds
            }
            
            return 'start'; // Default sound
        }

        function stopCurrentAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                currentAudio = null;
            }
        }

        function updateAudioAttribution(audioData) {
            let attributionElement = document.getElementById('audioAttribution');
            if (!attributionElement) {
                attributionElement = document.createElement('div');
                attributionElement.id = 'audioAttribution';
                attributionElement.className = 'sound-attribution';
                document.querySelector('.sidebar').appendChild(attributionElement);
            }
            
            attributionElement.innerHTML = `
                <strong>🎵 Ambient Sound:</strong> ${audioData.description}<br>
                <small>Source: ${audioData.attribution}</small>
                ${audioData.educational ? `<br><br><div style="background: #e8f4fd; padding: 10px; border-radius: 8px; margin-top: 8px; border-left: 3px solid #2196F3;">${audioData.educational}</div>` : ''}
            `;
        }

        // Mobile audio prompt for when autoplay is blocked
        function showMobileAudioPrompt() {
            // Check if we're on mobile
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile && !document.getElementById('mobileAudioPrompt')) {
                const prompt = document.createElement('div');
                prompt.id = 'mobileAudioPrompt';
                prompt.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 255, 255, 0.95);
                    padding: 20px;
                    border-radius: 15px;
                    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
                    z-index: 10000;
                    text-align: center;
                    max-width: 300px;
                `;
                
                prompt.innerHTML = `
                    <div style="font-size: 2em; margin-bottom: 10px;">🎵</div>
                    <h3 style="color: #8B4513; margin-bottom: 10px;">Enable Audio?</h3>
                    <p style="font-size: 14px; margin-bottom: 15px;">Tap to hear historical sounds as you explore!</p>
                    <button onclick="enableMobileAudio()" style="background: #4CAF50; color: white; border: none; padding: 12px 20px; border-radius: 20px; font-size: 16px; cursor: pointer;">🔊 Enable Sounds</button>
                    <br><br>
                    <button onclick="closeMobilePrompt()" style="background: #ccc; color: #666; border: none; padding: 8px 15px; border-radius: 15px; font-size: 14px; cursor: pointer;">Skip Audio</button>
                `;
                
                document.body.appendChild(prompt);
            }
        }

        // Enable audio on mobile after user interaction
        window.enableMobileAudio = function() {
            if (currentAudio) {
                currentAudio.play().catch(e => console.log('Mobile audio play failed:', e));
            }
            closeMobilePrompt();
        }

        // Close mobile audio prompt
        window.closeMobilePrompt = function() {
            const prompt = document.getElementById('mobileAudioPrompt');
            if (prompt) {
                prompt.remove();
            }
        }

        function updateDisplay() {
            const period = historicalPeriods[currentPeriod];
            
            // Update period information
            periodYears.textContent = period.years;
            periodTitle.textContent = period.title;
            periodDescription.textContent = period.description;
            
            // Update sidebar with detailed information
            updateSidebar(period);
            
            // Play period-appropriate ambient sound
            playPeriodAudio(currentPeriod);
            
            // Update map colors for different regions
            const galilee = document.getElementById('galilee');
            const samaria = document.getElementById('samaria');
            const judea = document.getElementById('judea');
            const negev = document.getElementById('negev');
            const coastalPlains = document.getElementById('coastalPlains');
            
            if (period.colors) {
                if (galilee) galilee.setAttribute('fill', period.colors.north || 'url(#plainsPattern)');
                if (samaria) samaria.setAttribute('fill', period.colors.central || 'url(#mountainPattern)');
                if (judea) judea.setAttribute('fill', period.colors.central || 'url(#mountainPattern)');
                if (negev) negev.setAttribute('fill', period.colors.south || 'url(#desertPattern)');
                if (coastalPlains) coastalPlains.setAttribute('fill', period.colors.north || 'url(#plainsPattern)');
            }
            
            // Update button states
            prevBtn.disabled = currentPeriod === 0;
            nextBtn.disabled = currentPeriod === historicalPeriods.length - 1;
            
            // Update period info background based on period
            const infoElement = document.getElementById('periodInfo');
            if (currentPeriod < 8) {
                infoElement.style.background = 'linear-gradient(135deg, #8B4513 0%, #D2691E 100%)'; // Ancient periods
            } else if (currentPeriod < 13) {
                infoElement.style.background = 'linear-gradient(135deg, #4682B4 0%, #5F9EA0 100%)'; // Medieval periods
            } else {
                infoElement.style.background = 'linear-gradient(135deg, #2E8B57 0%, #3CB371 100%)'; // Modern periods
            }
        }

        function updateSidebar(period) {
            const contextElement = document.getElementById('historicalContext');
            const keyEventsElement = document.getElementById('keyEvents');
            const transitionElement = document.getElementById('transitionInfo');
            const eventsListElement = document.getElementById('eventsList');
            const transitionTextElement = document.getElementById('transitionText');
            
            // Update historical context
            if (period.context) {
                contextElement.textContent = period.context;
            } else {
                contextElement.textContent = period.description;
            }
            
            // Update key events
            if (period.keyEvents && period.keyEvents.length > 0) {
                keyEventsElement.style.display = 'block';
                eventsListElement.innerHTML = '';
                period.keyEvents.forEach(event => {
                    const li = document.createElement('li');
                    li.textContent = event;
                    eventsListElement.appendChild(li);
                });
            } else {
                keyEventsElement.style.display = 'none';
            }
            
            // Update transition information
            if (period.transition) {
                transitionElement.style.display = 'block';
                transitionTextElement.textContent = period.transition;
            } else {
                transitionElement.style.display = 'none';
            }
        }

        function toggleAutoPlay() {
            if (isPlaying) {
                clearInterval(playInterval);
                isPlaying = false;
                playBtn.textContent = '▶️ Auto Play';
                soundManager.play('stop');
            } else {
                isPlaying = true;
                playBtn.textContent = '⏸️ Pause';
                soundManager.play('start');
                
                playInterval = setInterval(() => {
                    if (currentPeriod < historicalPeriods.length - 1) {
                        currentPeriod++;
                        slider.value = currentPeriod;
                        updateDisplay();
                    } else {
                        toggleAutoPlay(); // Stop at the end
                    }
                }, 3000); // Change every 3 seconds
            }
        }

        function showQuiz() {
            quizSection.style.display = 'block';
            currentQuizQuestion = Math.floor(Math.random() * quizQuestions.length);
            displayQuizQuestion();
            soundManager.play('start');
            
            // Scroll to quiz
            quizSection.scrollIntoView({ behavior: 'smooth' });
        }

        function displayQuizQuestion() {
            const question = quizQuestions[currentQuizQuestion];
            document.getElementById('quizQuestion').textContent = question.question;
            
            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => checkAnswer(index));
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('quizResult').textContent = '';
        }

        function checkAnswer(selectedIndex) {
            const question = quizQuestions[currentQuizQuestion];
            const options = document.querySelectorAll('.quiz-option');
            const resultElement = document.getElementById('quizResult');
            
            options.forEach((option, index) => {
                option.style.pointerEvents = 'none';
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedIndex) {
                    option.classList.add('incorrect');
                }
            });
            
            if (selectedIndex === question.correct) {
                resultElement.innerHTML = '✅ Correct! Well done!';
                resultElement.style.color = '#4CAF50';
                soundManager.play('correct');
            } else {
                resultElement.innerHTML = '❌ Not quite right. The correct answer is highlighted in green.';
                resultElement.style.color = '#dc3545';
                soundManager.play('incorrect');
            }
            
            setTimeout(() => {
                if (Math.random() > 0.5 && quizQuestions.length > 1) {
                    // Show another question
                    let newQuestion;
                    do {
                        newQuestion = Math.floor(Math.random() * quizQuestions.length);
                    } while (newQuestion === currentQuizQuestion);
                    currentQuizQuestion = newQuestion;
                    displayQuizQuestion();
                } else {
                    quizSection.style.display = 'none';
                }
            }, 3000);
        }

        // Territory click handlers for additional interactivity
        document.addEventListener('DOMContentLoaded', () => {
            const territoryElements = document.querySelectorAll('.territory');
            territoryElements.forEach(territory => {
                territory.addEventListener('click', (e) => {
                    const territoryId = e.target.id;
                    const period = historicalPeriods[currentPeriod];
                    alert(`${territoryId.charAt(0).toUpperCase() + territoryId.slice(1)} region during ${period.title} (${period.years})`);
                });
            });
        });

        // Initialize the application
        init();
    </script>
</body>
</html>